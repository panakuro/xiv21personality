<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FF14 ã‚¸ãƒ§ãƒ–æ€§æ ¼è¨ºæ–­</title>
<meta property="og:title" content="FF14 ã‚¸ãƒ§ãƒ–æ€§æ ¼è¨ºæ–­">
<meta property="og:description" content="24ã®å•ã„ã«ç­”ãˆã¦ã€ã‚ãªãŸã®é­‚ãŒå‘¼ã¶ã‚¸ãƒ§ãƒ–ã‚’è¦‹ã¤ã‘ã‚ˆã†ã€‚">
<meta property="og:image" content="https://panakuro.github.io/xiv21personality/image/ogp.png">
<meta property="og:url" content="https://panakuro.github.io/xiv21personality/">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="FF14 ã‚¸ãƒ§ãƒ–æ€§æ ¼è¨ºæ–­">
<meta name="twitter:description" content="24ã®å•ã„ã«ç­”ãˆã¦ã€ã‚ãªãŸã®é­‚ãŒå‘¼ã¶ã‚¸ãƒ§ãƒ–ã‚’è¦‹ã¤ã‘ã‚ˆã†ã€‚">
<meta name="twitter:image" content="https://panakuro.github.io/xiv21personality/image/ogp.png">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Noto+Serif+JP:wght@300;400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --gold: #c9a84c;
    --gold-light: #f0d080;
    --deep: #0a0812;
    --dark: #100e1a;
    --panel: #16122a;
    --panel2: #1e1838;
    --accent: #6a4fcf;
    --accent2: #9b6bff;
    --text: #e8dfc8;
    --text-dim: #8a7f6a;
    --glow: rgba(201,168,76,0.3);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Noto Serif JP', serif;
    background: var(--deep);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Background stars */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      radial-gradient(circle at 20% 30%, rgba(106,79,207,0.15) 0%, transparent 50%),
      radial-gradient(circle at 80% 70%, rgba(201,168,76,0.08) 0%, transparent 50%);
    pointer-events: none;
    z-index: 0;
  }

  .stars {
    position: fixed;
    inset: 0;
    z-index: 0;
    pointer-events: none;
  }

  .star {
    position: absolute;
    width: 2px;
    height: 2px;
    background: white;
    border-radius: 50%;
    animation: twinkle var(--dur, 3s) infinite;
    opacity: var(--op, 0.5);
  }

  @keyframes twinkle {
    0%, 100% { opacity: var(--op, 0.5); }
    50% { opacity: 0.1; }
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 800px;
    margin: 0 auto;
    padding: 40px 20px;
  }

  /* Header */
  .header {
    text-align: center;
    margin-bottom: 60px;
    animation: fadeDown 1s ease;
  }

  .header-badge {
    display: inline-block;
    border: 1px solid var(--gold);
    padding: 4px 20px;
    font-family: 'Cinzel', serif;
    font-size: 11px;
    letter-spacing: 4px;
    color: var(--gold);
    margin-bottom: 24px;
    text-transform: uppercase;
  }

  h1 {
    font-family: 'Cinzel', serif;
    font-size: clamp(28px, 6vw, 52px);
    font-weight: 900;
    line-height: 1.1;
    background: linear-gradient(135deg, var(--gold-light), var(--gold), #a07030);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: none;
    margin-bottom: 12px;
  }

  .subtitle {
    color: var(--text-dim);
    font-size: 14px;
    letter-spacing: 1px;
  }

  /* Divider */
  .divider {
    display: flex;
    align-items: center;
    gap: 16px;
    margin: 24px 0;
  }
  .divider::before, .divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: linear-gradient(to right, transparent, var(--gold), transparent);
  }
  .divider-gem {
    width: 8px;
    height: 8px;
    background: var(--gold);
    transform: rotate(45deg);
  }

  /* Screen transitions */
  .screen {
    display: none;
    animation: fadeIn 0.6s ease;
  }
  .screen.active { display: block; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  @keyframes fadeDown {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Intro card */
  .intro-card {
    border: 1px solid rgba(201,168,76,0.2);
    border-radius: 4px;
    text-align: center;
    position: relative;
    overflow: hidden;
  }

  .intro-hero-img {
    display: block;
    width: 100%;
    max-height: 560px;
    object-fit: contain;
    object-position: center;
  }

  .intro-overlay {
    position: absolute;
    inset: 0;
    background: rgba(10,8,18,0.55);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 48px 40px;
  }

  .intro-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--gold), transparent);
    z-index: 2;
  }

  .intro-icon {
    margin-bottom: 28px;
    display: block;
  }

  .intro-card p {
    color: var(--text);
    line-height: 1.8;
    font-size: 14px;
    margin-bottom: 32px;
    max-width: 500px;
    margin-left: auto;
    margin-right: auto;
    text-shadow: 0 1px 10px rgba(0,0,0,1), 0 0 30px rgba(0,0,0,1);
  }

  /* Buttons */
  .btn {
    display: inline-block;
    padding: 14px 40px;
    font-family: 'Cinzel', serif;
    font-size: 13px;
    letter-spacing: 3px;
    cursor: pointer;
    border: none;
    transition: all 0.3s ease;
    text-transform: uppercase;
    text-decoration: none;
  }

  .btn-primary {
    background: linear-gradient(135deg, var(--gold), #a07030);
    color: var(--deep);
    font-weight: 700;
    box-shadow: 0 0 30px var(--glow);
  }

  .btn-primary:hover {
    box-shadow: 0 0 50px rgba(201,168,76,0.5);
    transform: translateY(-2px);
  }

  .btn-secondary {
    background: transparent;
    color: var(--gold);
    border: 1px solid var(--gold);
    margin-top: 12px;
  }

  .btn-secondary:hover {
    background: rgba(201,168,76,0.1);
  }

  /* Progress */
  .progress-bar {
    background: var(--panel);
    border: 1px solid rgba(201,168,76,0.2);
    height: 4px;
    border-radius: 2px;
    margin-bottom: 40px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent), var(--gold));
    transition: width 0.5s ease;
    box-shadow: 0 0 10px var(--gold);
  }

  .progress-text {
    text-align: right;
    font-size: 11px;
    color: var(--text-dim);
    font-family: 'Cinzel', serif;
    letter-spacing: 2px;
    margin-bottom: 8px;
  }

  /* Question card */
  .question-card {
    background: var(--panel);
    border: 1px solid rgba(201,168,76,0.2);
    border-radius: 4px;
    padding: 40px;
    position: relative;
    overflow: hidden;
  }

  .question-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--gold), transparent);
  }

  .question-number {
    font-family: 'Cinzel', serif;
    font-size: 11px;
    letter-spacing: 4px;
    color: var(--gold);
    margin-bottom: 16px;
    text-transform: uppercase;
  }

  .question-text {
    font-size: clamp(16px, 3vw, 22px);
    font-weight: 700;
    line-height: 1.6;
    margin-bottom: 36px;
    color: var(--text);
  }

  /* Quiz instruction banner */
  .quiz-instruction {
    text-align: center;
    font-family: 'Cinzel', serif;
    font-size: 12px;
    letter-spacing: 3px;
    color: var(--gold);
    border: 1px solid rgba(201,168,76,0.25);
    padding: 10px 20px;
    margin-bottom: 28px;
    background: rgba(201,168,76,0.05);
  }

  /* Scale UI */
  .question-text {
    font-size: clamp(15px, 2.8vw, 20px);
    font-weight: 700;
    line-height: 1.7;
    margin-bottom: 32px;
    color: var(--text);
  }

  .scale-wrap {
    display: flex;
    flex-direction: column;
    gap: 0;
  }

  .scale-row {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 10px 0;
    border-bottom: 1px solid rgba(201,168,76,0.07);
    cursor: pointer;
    transition: background 0.2s;
    border-radius: 3px;
  }

  .scale-row:last-child { border-bottom: none; }

  .scale-row:hover { background: rgba(201,168,76,0.05); }

  .scale-row.selected {
    background: rgba(201,168,76,0.08);
  }

  .scale-radio {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    border: 2px solid rgba(201,168,76,0.3);
    flex-shrink: 0;
    transition: all 0.2s;
    position: relative;
    margin-left: 8px;
  }

  .scale-row.selected .scale-radio {
    border-color: var(--gold);
    background: var(--gold);
    box-shadow: 0 0 10px var(--glow);
  }

  .scale-row.selected .scale-radio::after {
    content: '';
    position: absolute;
    inset: 4px;
    background: var(--deep);
    border-radius: 50%;
  }

  .scale-label {
    font-size: 13px;
    color: var(--text-dim);
    transition: color 0.2s;
    line-height: 1.5;
  }

  .scale-row.selected .scale-label {
    color: var(--gold-light);
  }

  .scale-row:hover .scale-label {
    color: var(--text);
  }

  .scale-tag {
    margin-left: auto;
    margin-right: 8px;
    font-size: 10px;
    font-family: 'Cinzel', serif;
    letter-spacing: 1px;
    color: rgba(201,168,76,0.35);
    white-space: nowrap;
  }

  .scale-row.selected .scale-tag {
    color: var(--gold);
  }

  .next-btn {
    display: block;
    margin: 28px auto 0;
    padding: 12px 40px;
    background: linear-gradient(135deg, var(--gold), #a07030);
    color: var(--deep);
    font-family: 'Cinzel', serif;
    font-size: 12px;
    font-weight: 700;
    letter-spacing: 3px;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    opacity: 0;
    pointer-events: none;
  }

  .next-btn.visible {
    opacity: 1;
    pointer-events: auto;
  }

  .next-btn:hover {
    box-shadow: 0 0 30px var(--glow);
    transform: translateY(-2px);
  }

  /* Loading */
  .loading {
    text-align: center;
    padding: 80px 20px;
  }

  .crystal {
    width: 60px;
    height: 60px;
    margin: 0 auto 32px;
    position: relative;
  }

  .crystal-inner {
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--accent), var(--gold));
    clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);
    animation: pulse 1.5s infinite;
  }

  @keyframes pulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.1); opacity: 0.7; }
  }

  .loading-text {
    font-family: 'Cinzel', serif;
    color: var(--gold);
    letter-spacing: 4px;
    font-size: 13px;
  }

  /* Result card */
  .result-card {
    text-align: center;
  }

  /* ã‚¸ãƒ§ãƒ–ã‚¢ãƒ¼ãƒˆï¼šå…¨å¹…ãƒ’ãƒ¼ãƒ­ãƒ¼è¡¨ç¤º */
  .result-hero {
    position: relative;
    width: 100%;
    max-width: 700px;
    margin: 0 auto 32px;
    border-radius: 4px;
    overflow: hidden;
  }

  .result-job-art {
    width: 100%;
    height: auto;
    max-height: 520px;
    object-fit: cover;
    object-position: top center;
    display: block;
    filter: drop-shadow(0 0 40px rgba(201,168,76,0.3));
    animation: float 4s ease-in-out infinite;
  }

  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
  }

  @media (max-width: 500px) {
    .result-job-art { max-height: 340px; }
  }

  /* ç”»åƒä¸Šã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
  .result-hero::after {
    content: '';
    position: absolute;
    inset: 0;
    background:
      linear-gradient(to top, rgba(10,8,18,0.95) 0%, rgba(10,8,18,0.4) 40%, transparent 70%),
      linear-gradient(to bottom, rgba(10,8,18,0.5) 0%, transparent 30%);
    pointer-events: none;
  }

  /* ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ãƒ†ã‚­ã‚¹ãƒˆï¼ˆç”»åƒã®ä¸Šï¼‰ */
  .result-overlay-top {
    position: absolute;
    top: 20px;
    left: 0; right: 0;
    z-index: 2;
    text-align: center;
    padding: 0 20px;
  }

  .result-overlay-bottom {
    position: absolute;
    bottom: 24px;
    left: 0; right: 0;
    z-index: 2;
    text-align: center;
    padding: 0 20px;
  }

  .result-mbti {
    font-family: 'Cinzel', serif;
    font-size: 13px;
    letter-spacing: 6px;
    color: var(--accent2);
    text-shadow: 0 0 20px rgba(155,107,255,0.8);
    margin-bottom: 6px;
  }

  .result-job-name {
    font-family: 'Cinzel', serif;
    font-size: clamp(36px, 9vw, 72px);
    font-weight: 900;
    background: linear-gradient(135deg, #fff 0%, var(--gold-light) 40%, var(--gold) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1;
    margin-bottom: 6px;
    text-shadow: none;
    filter: drop-shadow(0 2px 20px rgba(201,168,76,0.6));
  }

  .result-job-name-jp {
    font-size: 15px;
    color: rgba(232,223,200,0.8);
    letter-spacing: 2px;
  }

  .result-panel {
    background: var(--panel);
    border: 1px solid rgba(201,168,76,0.2);
    border-radius: 4px;
    padding: 32px;
    margin: 24px 0;
    position: relative;
    overflow: hidden;
    text-align: left;
  }

  .result-panel::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--gold), transparent);
  }

  .result-desc {
    font-size: 15px;
    line-height: 2;
    color: var(--text);
    margin-bottom: 24px;
  }

  .traits {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 16px;
  }

  .trait {
    padding: 4px 14px;
    border: 1px solid rgba(201,168,76,0.3);
    font-size: 12px;
    color: var(--gold);
    letter-spacing: 1px;
    font-family: 'Cinzel', serif;
  }

  .score-bars {
    margin-top: 24px;
  }

  .score-bar {
    margin-bottom: 12px;
  }

  .score-label {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    color: var(--text-dim);
    margin-bottom: 6px;
    letter-spacing: 1px;
  }

  .score-track {
    height: 6px;
    background: rgba(255,255,255,0.05);
    border-radius: 3px;
    overflow: hidden;
  }

  .score-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 1s ease 0.5s;
  }




  /* Role triangle chart */
  .role-chart {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid rgba(201,168,76,0.15);
  }

  .role-chart-title {
    text-align: center;
    font-family: 'Cinzel', serif;
    font-size: 11px;
    letter-spacing: 3px;
    color: var(--text-dim);
    margin-bottom: 16px;
    text-transform: uppercase;
  }

  .role-pentagon {
    display: block;
    margin: 0 auto;
  }

  /* Share */
  .share-area {
    margin-top: 32px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
  }

  .btn-x {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 14px 32px;
    background: #000;
    color: #fff;
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 3px;
    font-family: 'Cinzel', serif;
    font-size: 13px;
    letter-spacing: 2px;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.3s ease;
  }

  .btn-x:hover {
    background: #1a1a1a;
    border-color: rgba(255,255,255,0.4);
    transform: translateY(-2px);
  }

  .btn-x svg {
    width: 18px;
    height: 18px;
    fill: white;
  }

  .btn-retry {
    background: transparent;
    color: var(--text-dim);
    border: 1px solid rgba(201,168,76,0.2);
    padding: 10px 24px;
    font-family: 'Cinzel', serif;
    font-size: 11px;
    letter-spacing: 3px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
  }

  .btn-retry:hover {
    color: var(--gold);
    border-color: var(--gold);
  }

  /* Axes labels */
  .axes {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-top: 16px;
  }

  .axis-label {
    font-size: 11px;
    color: var(--text-dim);
    letter-spacing: 1px;
  }

  /* ç›¸æ€§ã‚¸ãƒ§ãƒ–ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
  .compat-section {
    margin-bottom: 24px;
  }
  .compat-title {
    font-family: 'Cinzel', serif;
    font-size: 11px;
    letter-spacing: 4px;
    color: var(--gold);
    text-align: center;
    margin-bottom: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
  }
  .compat-title-deco { opacity: 0.5; }
  .compat-subtitle {
    font-size: 12px;
    color: var(--text-dim);
    text-align: center;
    letter-spacing: 2px;
    margin-bottom: 20px;
  }
  .compat-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  .compat-card {
    display: flex;
    gap: 16px;
    align-items: center;
    background: var(--panel2);
    border: 1px solid rgba(201,168,76,0.15);
    border-radius: 4px;
    padding: 14px 16px;
    position: relative;
    overflow: hidden;
    transition: border-color 0.2s;
  }
  .compat-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(201,168,76,0.3), transparent);
  }
  .compat-card:hover { border-color: rgba(201,168,76,0.35); }
  .compat-img-wrap {
    width: 90px;
    height: 90px;
    flex-shrink: 0;
    overflow: hidden;
    background: transparent;
  }
  .compat-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: top center;
  }
  .compat-icon-fallback {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
  }
  .compat-info { flex: 1; min-width: 0; }
  .compat-mbti {
    font-family: 'Cinzel', serif;
    font-size: 10px;
    letter-spacing: 3px;
    color: var(--accent2);
    margin-bottom: 3px;
  }
  .compat-name {
    font-family: 'Cinzel', serif;
    font-size: 17px;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 2px;
    line-height: 1.2;
  }
  .compat-name-jp {
    font-size: 11px;
    color: var(--text-dim);
    letter-spacing: 1px;
    margin-bottom: 8px;
  }
  .compat-comment {
    font-size: 12px;
    color: rgba(232,223,200,0.75);
    line-height: 1.7;
  }
  .compat-badge {
    position: absolute;
    top: 10px; right: 12px;
    font-family: 'Cinzel', serif;
    font-size: 9px;
    letter-spacing: 1px;
    padding: 2px 8px;
    border-radius: 2px;
    border: 1px solid;
  }

/* === Image placeholders (Base64 removed) ===
   This file intentionally removes heavy base64 images for editing with Claude.
   Replace placeholder src with your own images later if needed.
*/
img[src=""], img:not([src]) { background: rgba(255,255,255,0.03); }

</style>
</head>
<body>

<div class="stars" id="stars"></div>

<div class="container">
  <div class="header">
    <div class="header-badge">Eorzea Job Divination</div>
    <h1 onclick="goHome()" style="cursor:pointer;" title="ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹">FF14 ã‚¸ãƒ§ãƒ–æ€§æ ¼è¨ºæ–­</h1>
    <p class="subtitle">ã‚ãªãŸã®é­‚ãŒå‘¼ã¶ã‚¸ãƒ§ãƒ–ã‚’ã€æ˜ŸãŒå‘Šã’ã‚‹</p>
    <div class="divider"><div class="divider-gem"></div></div>
    <div style="text-align:center; margin-top: -20px; margin-bottom: 8px;">
      <a href="xiv21personality-list.html" style="
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-family: 'Noto Serif JP', serif;
        font-size: 13px;
        letter-spacing: 2px;
        color: var(--gold);
        border: 1px solid rgba(201,168,76,0.35);
        padding: 10px 28px;
        text-decoration: none;
        transition: all 0.3s ease;
        background: rgba(201,168,76,0.05);
      " onmouseover="this.style.background='rgba(201,168,76,0.12)';this.style.borderColor='rgba(201,168,76,0.7)';this.style.boxShadow='0 0 20px rgba(201,168,76,0.2)'" onmouseout="this.style.background='rgba(201,168,76,0.05)';this.style.borderColor='rgba(201,168,76,0.35)';this.style.boxShadow='none'">
        <span style="font-size:15px">âœ¦</span>
        å…¨ã‚¸ãƒ§ãƒ–è¨ºæ–­çµæœä¸€è¦§ã‚’è¦‹ã‚‹
        <span style="font-size:15px">âœ¦</span>
      </a>
    </div>
  </div>

  <!-- Intro Screen -->
  <div class="screen active" id="screen-intro">
    <div class="intro-card">
      <img class="intro-hero-img" src="image/Crystal.png" alt="">
      <div class="intro-overlay">
        <p>
          24ã®å•ã„ã«ç­”ãˆã‚‹ã“ã¨ã§ã€<br>ã‚ãªãŸã®å†…ãªã‚‹æ€§æ ¼ã‹ã‚‰ã‚¨ã‚ªãƒ«ã‚¼ã‚¢ã«ç›¸å¿œã—ã„ã‚¸ãƒ§ãƒ–ã‚’å°ãå‡ºã—ã¾ã™ã€‚<br>
          MBTIçš„ãª4è»¸ï¼ˆE/Iãƒ»S/Nãƒ»T/Fãƒ»J/Pï¼‰ã‚’ã‚‚ã¨ã«<br>21ã®ã‚¸ãƒ§ãƒ–ã‚¿ã‚¤ãƒ—ã¸ãƒãƒƒãƒ”ãƒ³ã‚°ã€‚<br>
          è¨ºæ–­çµæœã¯Xã§ã‚·ã‚§ã‚¢ã§ãã¾ã™ã€‚
        </p>
        <button class="btn btn-primary" onclick="startQuiz()">è¨ºæ–­ã‚’å§‹ã‚ã‚‹</button>
        <button class="btn btn-secondary" id="debug-btn" style="display:none" onclick="runDebugSimulation()">ãƒ‡ãƒãƒƒã‚°ï¼šãƒ©ãƒ³ãƒ€ãƒ 10,000å›</button>
        <div id="debug-status" style="display:none;margin-top:10px;font-size:12px;color:rgba(232,223,200,0.7);"></div>
      </div>
    </div>
  </div>

  <!-- Quiz Screen -->
  <div class="screen" id="screen-quiz">
    <div class="quiz-instruction">è‡ªåˆ†ã«è¿‘ã„ã‚‚ã®ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
    <div class="progress-text" id="progress-text">Question 1 / 20</div>
    <div class="progress-bar">
      <div class="progress-fill" id="progress-fill" style="width:5%"></div>
    </div>
    <div class="question-card" id="question-card">
      <div class="question-number" id="question-number">ç¬¬ 1 å•</div>
      <div class="question-text" id="question-text"></div>
      <div id="scale-area"></div>
    </div>
  </div>

  <!-- Loading Screen -->
  <div class="screen" id="screen-loading">
    <div class="loading">
      <div class="crystal"><div class="crystal-inner"></div></div>
      <div class="loading-text">å æ˜Ÿç›¤ãŒå»»ã‚‹...</div>
    </div>
  </div>

  <!-- Result Screen -->
  <div class="screen" id="screen-result">
    <div class="result-card">

      <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ç”»åƒ + ãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
      <div class="result-hero">
        <span id="result-icon"></span>
        <div class="result-overlay-top">
          <div class="result-mbti" id="result-mbti"></div>
        </div>
        <div class="result-overlay-bottom">
          <div class="result-job-name" id="result-job-name"></div>
          <div class="result-job-name-jp" id="result-job-name-jp"></div>
        </div>
      </div>

      <div class="result-panel">
        <div class="result-desc" id="result-desc"></div>
        <div class="traits" id="result-traits"></div>
        <div class="score-bars" id="score-bars"></div>
      </div>

      <!-- ç›¸æ€§ã‚¸ãƒ§ãƒ– -->
      <div class="compat-section">
        <div class="compat-title">
          <span class="compat-title-deco">âœ¦</span>
          COMPATIBLE JOBS
          <span class="compat-title-deco">âœ¦</span>
        </div>
        <div class="compat-subtitle">ç›¸æ€§ã®ã„ã„ã‚¸ãƒ§ãƒ–</div>
        <div class="compat-list" id="compat-list"></div>
      </div>

      <div class="share-area">
        <a class="btn-x" id="share-btn" href="#" target="_blank">
          <svg viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-4.714-6.231-5.401 6.231H2.741l7.73-8.835L1.254 2.25H8.08l4.259 5.622L18.243 2.25zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
          Xã§ã‚·ã‚§ã‚¢ã™ã‚‹
        </a>
        <button class="btn-retry" onclick="restartQuiz()">ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹</button>
      </div>
    </div>
  </div>
</div>

<script>
const JOB_IMAGES = {
  Paladin: "image/jobart/Paladin.png",
  Warrior: "image/jobart/Warrior.png",
  DarkKnight: "image/jobart/Dark_Knight.png",
  Gunbreaker: "image/jobart/Gunbreaker.png",
  WhiteMage: "image/jobart/White_Mage.png",
  Scholar: "image/jobart/Scholar.png",
  Astrologian: "image/jobart/Astrologian.png",
  Sage: "image/jobart/Sage.png",
  Monk: "image/jobart/Monk.png",
  Ninja: "image/jobart/Ninja.png",
  Reaper: "image/jobart/Reaper.png",
  Samurai: "image/jobart/Samurai.png",
  Viper: "image/jobart/Viper.png",
  Dragoon: "image/jobart/Dragoon.png",
  Bard: "image/jobart/Bard.png",
  Dancer: "image/jobart/Dancer.png",
  Machinist: "image/jobart/Machinist.png",
  Summoner: "image/jobart/Summoner.png",
  BlackMage: "image/jobart/Black_Mage.png",
  RedMage: "image/jobart/Red_Mage.png",
  Pictomancer: "image/jobart/Pictomancer.png",
  BlueMage: "image/jobart/Blue_Mage.png",
};

// ===== 7æ®µéšãƒ©ãƒ™ãƒ« =====
const SCALE = [
  { val: +3, label: "å¼·ããã†æ€ã†" },
  { val: +2, label: "ãã†æ€ã†" },
  { val: +1, label: "ã©ã¡ã‚‰ã‹ã¨ã„ãˆã°ãã†æ€ã†" },
  { val:  0, label: "ã©ã¡ã‚‰ã¨ã‚‚ã„ãˆãªã„" },
  { val: -1, label: "ã©ã¡ã‚‰ã‹ã¨ã„ãˆã°ãã†æ€ã‚ãªã„" },
  { val: -2, label: "ãã†æ€ã‚ãªã„" },
  { val: -3, label: "å…¨ããã†æ€ã‚ãªã„" },
];

// ===== è³ªå•ãƒ‡ãƒ¼ã‚¿ï¼ˆ24å•ãƒ»1å•1è»¸ãƒ»æ­£è»¢3ï¼‹é€†è»¢3ã®å¯¾ç§°è¨­è¨ˆï¼‰=====
// axis ã®æ­£æ–¹å‘ = E / S / T / J
// reversed:true ã®å•ã¯å›ç­”å€¤ã‚’åè»¢ã—ã¦åŠ ç®—
const questions = [
  // â”€â”€ E / Iï¼ˆæ­£è»¢3ãƒ»é€†è»¢3ï¼‰â”€â”€
  { axis:"EI", reversed:false, text:"åˆå¯¾é¢ã®äººã¨ã§ã‚‚ã€è©±ã—ã¦ã„ã‚‹ã†ã¡ã«è‡ªç„¶ã¨æ‰“ã¡è§£ã‘ã‚‰ã‚Œã‚‹æ–¹ã ã€‚" },
  { axis:"EI", reversed:false, text:"ã‚°ãƒ«ãƒ¼ãƒ—ã§ä½•ã‹ã‚’ã™ã‚‹ã¨ãã€è‡ªåˆ†ã‹ã‚‰æ„è¦‹ã‚’å‡ºã—ã¦ã¾ã¨ã‚å½¹ã«ãªã‚‹ã“ã¨ãŒå¤šã„ã€‚" },
  { axis:"EI", reversed:false, text:"é€±æœ«ã¯èª°ã‹ã¨éã”ã™äºˆå®šã‚’å…¥ã‚ŒãŸæ–¹ãŒã€å……å®Ÿæ„Ÿã‚’æ„Ÿã˜ã‚„ã™ã„ã€‚" },
  { axis:"EI", reversed:true,  text:"é•·ã„æ™‚é–“äººã¨ä¸€ç·’ã«ã„ã‚‹ã¨ã€ã²ã¨ã‚Šã«ãªã£ã¦å›å¾©ã—ãŸããªã‚‹ã€‚" },
  { axis:"EI", reversed:true,  text:"è‡ªåˆ†ã®è€ƒãˆã‚’å£ã«å‡ºã™ã‚ˆã‚Šã€é ­ã®ä¸­ã§æ•´ç†ã—ã¦ã‹ã‚‰è©±ã™æ–¹ãŒå¥½ãã ã€‚" },
  { axis:"EI", reversed:true,  text:"è³‘ã‚„ã‹ãªå ´ã«ã„ã‚‹ã‚ˆã‚Šã€é™ã‹ãªç’°å¢ƒã§ã²ã¨ã‚Šã«é›†ä¸­ã—ã¦ã„ã‚‹æ–¹ãŒè½ã¡ç€ãã€‚" },

  // â”€â”€ S / Nï¼ˆæ­£è»¢3ãƒ»é€†è»¢3ï¼‰â”€â”€
  { axis:"SN", reversed:false, text:"ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’è€ƒãˆã‚‹ã‚ˆã‚Šã€å…·ä½“çš„ãªä½œæ¥­ã‚’ã“ãªã—ã¦ã„ã‚‹æ–¹ãŒå……å®Ÿæ„ŸãŒã‚ã‚‹ã€‚" },
  { axis:"SN", reversed:false, text:"ç‰©äº‹ã‚’åˆ¤æ–­ã™ã‚‹ã¨ãã€å‹˜ã‚„ç›´æ„Ÿã‚ˆã‚Šå®Ÿç¸¾ã‚„çµŒé¨“ã‚’ã‚‚ã¨ã«ã™ã‚‹æ–¹ãŒä¿¡é ¼ã§ãã‚‹ã€‚" },
  { axis:"SN", reversed:false, text:"æ–°ã—ã„ã“ã¨ã‚’è¦šãˆã‚‹ã¨ãã€æ‰‹é †ã‚’ä¸€ã¤ãšã¤ç¢ºå®Ÿã«èº«ã«ã¤ã‘ã¦ã„ãæ–¹ãŒå¥½ãã ã€‚" },
  { axis:"SN", reversed:true,  text:"ç›®ã®å‰ã®ã“ã¨ã‚ˆã‚Šã€ãã®å…ˆã«ä½•ãŒã‚ã‚‹ã‹ã‚’è€ƒãˆã¦ã„ã‚‹æ–¹ãŒæ¥½ã—ã„ã€‚" },
  { axis:"SN", reversed:true,  text:"æ—¢å­˜ã®ã‚„ã‚Šæ–¹ã‚ˆã‚Šã€ã‚‚ã£ã¨è‰¯ã„æ–¹æ³•ãŒã‚ã‚‹ã¯ãšã ã¨è€ƒãˆã‚‹ã“ã¨ãŒå¤šã„ã€‚" },
  { axis:"SN", reversed:true,  text:"ç´°ã‹ã„äº‹å®Ÿã‚’ç©ã¿ä¸Šã’ã‚‹ã‚ˆã‚Šã€å…¨ä½“ã®æ„å‘³ã‚„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ´ã‚€æ–¹ãŒå¾—æ„ã ã€‚" },

  // â”€â”€ T / Fï¼ˆæ­£è»¢3ãƒ»é€†è»¢3ï¼‰â”€â”€
  { axis:"TF", reversed:false, text:"æ„Ÿæƒ…çš„ãªå ´é¢ã§ã‚‚ã€ã¾ãšçŠ¶æ³ã‚’æ•´ç†ã—ã¦è«–ç†çš„ã«å¯¾å¿œã—ã‚ˆã†ã¨ã™ã‚‹æ–¹ã ã€‚" },
  { axis:"TF", reversed:false, text:"èª°ã‹ã®ã‚„ã‚Šæ–¹ã«å•é¡ŒãŒã‚ã‚‹ã¨æ€ã£ãŸã¨ãã€ç›¸æ‰‹ã®æ°—æŒã¡ã‚ˆã‚Šæ­£ã—ã•ã‚’å„ªå…ˆã™ã‚‹ã€‚" },
  { axis:"TF", reversed:false, text:"æ„è¦‹ãŒå¯¾ç«‹ã—ãŸã¨ãã€ç›¸æ‰‹ã¨ã®é–¢ä¿‚ã‚ˆã‚Šè©±ã®ç­‹ãŒé€šã£ã¦ã„ã‚‹ã‹ã‚’å…ˆã«è€ƒãˆã‚‹ã€‚" },
  { axis:"TF", reversed:true,  text:"æ­£ã—ã„ã“ã¨ã‚ˆã‚Šã€ç›¸æ‰‹ãŒã©ã†æ„Ÿã˜ã‚‹ã‹ã‚’å…ˆã«è€ƒãˆã¦ã—ã¾ã†ã€‚" },
  { axis:"TF", reversed:true,  text:"æ±ºæ–­ã™ã‚‹ã¨ãã€ç†å±ˆã‚ˆã‚Šã‚‚è‡ªåˆ†ã‚„å‘¨å›²ã®æ°—æŒã¡ãŒæ±ºã‚æ‰‹ã«ãªã‚‹ã“ã¨ãŒå¤šã„ã€‚" },
  { axis:"TF", reversed:true,  text:"èª°ã‹ãŒè½ã¡è¾¼ã‚“ã§ã„ã‚‹ã¨ãã€åŸå› ã®åˆ†æã‚ˆã‚Šå…ˆã«æ°—æŒã¡ã«å¯„ã‚Šæ·»ã„ãŸããªã‚‹ã€‚" },

  // â”€â”€ J / Pï¼ˆæ­£è»¢3ãƒ»é€†è»¢3ï¼‰â”€â”€
  { axis:"JP", reversed:false, text:"ä½•ã‹ã‚’å§‹ã‚ã‚‹å‰ã«ã€ã‚´ãƒ¼ãƒ«ã¨æ®µå–ã‚Šã‚’æ±ºã‚ã¦ãŠã‹ãªã„ã¨è½ã¡ç€ã‹ãªã„ã€‚" },
  { axis:"JP", reversed:false, text:"ç· ã‚åˆ‡ã‚Šã‚„ç´„æŸã¯ã€å‰å€’ã—ã§ç‰‡ä»˜ã‘ã¦ãŠãæ–¹ãŒæ°—æŒã¡ã‚ˆãéã”ã›ã‚‹ã€‚" },
  { axis:"JP", reversed:false, text:"æ±ºã‚ãŸã“ã¨ã‚’æœ€å¾Œã¾ã§ä¸€è²«ã—ã¦ã‚„ã‚Šé‚ã’ã‚‹ã“ã¨ã«ã€ã“ã ã‚ã‚ŠãŒã‚ã‚‹æ–¹ã ã€‚" },
  { axis:"JP", reversed:true,  text:"è¨ˆç”»ã‚ˆã‚Šã€ãã®ã¨ãã®æµã‚Œã‚„æ°—åˆ†ã«åˆã‚ã›ã¦å‹•ãæ–¹ãŒè‡ªåˆ†ã‚‰ã—ã„ã€‚" },
  { axis:"JP", reversed:true,  text:"é¸æŠè‚¢ã‚’ãªã‚‹ã¹ãé–‹ã„ãŸã¾ã¾ã«ã—ã¦ãŠããŸã„ã€æ—©ãæ±ºã‚ã‚‹ã®ãŒè‹¦æ‰‹ã ã€‚" },
  { axis:"JP", reversed:true,  text:"ã‚„ã‚‹ã“ã¨ã‚’æ±ºã‚ãšã«å‹•ãå§‹ã‚ã¦ã€å¾Œã‹ã‚‰å½¢ã‚’æ•´ãˆã¦ã„ãæ–¹ãŒæ€§ã«åˆã£ã¦ã„ã‚‹ã€‚" },
];
  // Expose for debug tools
  window.questions = questions;

// ===== ãƒ­ãƒ¼ãƒ«åˆ¤å®šï¼ˆMBTIã‚¹ã‚³ã‚¢ã®ã¿ã‹ã‚‰å°å‡ºï¼‰=====
//
// å„è»¸ã®æ„å‘³ï¼š
//   EI: E(+)=é›†å›£ãƒ»å¤–å‘ã â†’ TANK/HEALERå‘ã  I(-)=å˜ç‹¬ãƒ»å†…å‘ã â†’ CDPS/RDPSå‘ã
//   TF: T(+)=è«–ç†ãƒ»å†·é™   â†’ TANK/MDPSå‘ã    F(-)=å…±æ„Ÿãƒ»æ„Ÿæƒ…   â†’ HEALER/RDPSå‘ã
//   SN: S(+)=å®Ÿè·µãƒ»èº«ä½“   â†’ MDPS/RDPSå‘ã    N(-)=ç›´æ„Ÿãƒ»ç†è«–   â†’ CDPSå‘ã
//   JP: J(+)=è²¬ä»»ãƒ»è¨ˆç”»   â†’ TANK/HEALERå‘ã  P(-)=è‡ªç”±ãƒ»å³èˆˆ   â†’ DPSå…¨èˆ¬å‘ã
//
// å„è»¸ã‚¹ã‚³ã‚¢ã‚’ -15ã€œ+15 ã®ç¯„å›²ã§å—ã‘å–ã‚Šã€å„ãƒ­ãƒ¼ãƒ«ã¸ã®é‡ã¿ä»˜ãã‚¹ã‚³ã‚¢ã‚’ç®—å‡ºã—ã¦æœ€å¤§ã‚’è¿”ã™

function determineRoleScores(axisScores) {
  // FF14ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯Iãƒ»Nå¯„ã‚Šã®æ¯é›†å›£ãƒã‚¤ã‚¢ã‚¹ãŒã‚ã‚‹ãŸã‚è£œæ­£
  const norm = (x, offset = 0) => {
    const v = (Number(x) || 0) - offset;
    return Math.max(-1, Math.min(1, v / 12));
  };

  const ei = norm(axisScores.EI, 0);
  const sn = norm(axisScores.SN, 0);
  const tf = norm(axisScores.TF, 0);
  const jp = norm(axisScores.JP, 0);

  const s = { TANK: 0, HEALER: 0, MDPS: 0, RDPS: 0, CDPS: 0 };

  // EI
  s.TANK   += ei * 0.15;
  s.HEALER += ei * 0.18;
  s.RDPS   += ei * 0.18;
  s.CDPS   -= ei * 0.18;
  s.MDPS   -= ei * 0.08;

  // TF: Tâ†’TANK/MDPS/CDPS, Fâ†’HEALER/RDPS
  s.MDPS   += tf * 0.25;
  s.TANK   += tf * 0.25;
  s.CDPS   += tf * 0.20;
  s.HEALER -= tf * 0.28;
  s.RDPS   -= tf * 0.15;

  // SN: Sâ†’MDPS/RDPS/TANK, Nâ†’CDPS
  s.MDPS   += sn * 0.20;
  s.RDPS   += sn * 0.18;
  s.TANK   += sn * 0.20;
  s.CDPS   -= sn * 0.22;
  s.HEALER -= sn * 0.08;

  // JP: Jâ†’HEALER/TANK, Pâ†’DPS/CDPS
  s.TANK   += jp * 0.10;
  s.HEALER += jp * 0.18;
  s.MDPS   -= jp * 0.12;
  s.RDPS   -= jp * 0.12;
  s.CDPS   += jp * 0.05;

  return s;
}

function determineRole(axisScores) {
  const s = determineRoleScores(axisScores);
  let bestRole = 'MDPS';
  let bestScore = -Infinity;
  for (const [role, score] of Object.entries(s)) {
    if (score > bestScore) { bestScore = score; bestRole = role; }
  }
  return bestRole;
}

function determineRole(axisScores) {
  const s = determineRoleScores(axisScores);

  // æœ€é«˜ã‚¹ã‚³ã‚¢ã®ãƒ­ãƒ¼ãƒ«ã‚’ç¢ºå®šçš„ã«è¿”ã™
  // ï¼ˆsoftmaxã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã¯å‚¾å‘ã¨é•ã†çµæœã‚’è¿”ã™ã“ã¨ãŒã‚ã‚‹ãŸã‚å»ƒæ­¢ï¼‰
  let bestRole = 'MDPS';
  let bestScore = -Infinity;
  for (const [role, score] of Object.entries(s)) {
    if (score > bestScore) {
      bestScore = score;
      bestRole = role;
    }
  }
  return bestRole;
}

// ===== ã‚¸ãƒ§ãƒ–ãƒã‚¹ã‚¿ =====
// key: MBTI_ROLE
const jobMap = {
  // â”€â”€â”€ TANK â”€â”€â”€
  ENTJ_TANK: { name:"Paladin",    nameJp:"ãƒŠã‚¤ãƒˆ",       icon:"ğŸ›¡ï¸", color:"#5b8dd9", role:"ã‚¿ãƒ³ã‚¯",
    desc:"å¼·é­ãªæ„å¿—ã¨å†·é™ãªæŒ‡æ®åŠ›ã§å‰ç·šã‚’ç‡ã„ã‚‹ãƒªãƒ¼ãƒ€ãƒ¼ã€‚ä»²é–“ã‚’å®ˆã‚ŠãªãŒã‚‰æˆ¦å ´ã‚’æ”¯é…ã™ã‚‹ãƒŠã‚¤ãƒˆã¯ã€ã‚ãªãŸã®ã€Œæ­£ç¾©ã‚’ä½“ç¾ã™ã‚‹è€…ã€ã¨ã—ã¦ã®æœ¬è³ªãã®ã‚‚ã®ã€‚",
    traits:["ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—","æ±ºæ–­åŠ›","æˆ¦ç•¥æ€è€ƒ","ä½¿å‘½æ„Ÿ"], imgKey:"Paladin" },
  ESTJ_TANK: { name:"Warrior",    nameJp:"æˆ¦å£«",         icon:"ğŸª“", color:"#c04b1a", role:"ã‚¿ãƒ³ã‚¯",
    desc:"åŠ›ã¨è¦å¾‹ã§æˆ¦å ´ã‚’åˆ¶ã™ã‚‹ä¸å‹•ã®ç›¾ã€‚æˆ¦å£«ã®åœ§å€’çš„ãªè‡ªå·±å›å¾©ã¨å®‰å®šã—ãŸå­˜åœ¨æ„Ÿã¯ã€ã‚ãªãŸã®ã€Œå®Ÿç›´ãƒ»ä¿¡é ¼ãƒ»è¡Œå‹•åŠ›ã€ã®ä¸‰æ‹å­ã‚’è±¡å¾´ã—ã¾ã™ã€‚é€ƒã’ãšã€é€€ã‹ãšã€ãŸã å‰ã¸ã€‚",
    traits:["å®Ÿç›´","å¿è€åŠ›","å®‰å®šæ„Ÿ","è¡Œå‹•åŠ›"], imgKey:"Warrior" },
  ISTJ_TANK: { name:"Dark Knight", nameJp:"æš—é»’é¨å£«",    icon:"ğŸŒ‘", color:"#4040a0", role:"ã‚¿ãƒ³ã‚¯",
    desc:"å†…ãªã‚‹æš—é—‡ã¨å‘ãåˆã„ãªãŒã‚‰ä»²é–“ã‚’å®ˆã‚‹èª å®Ÿãªå­¤ç‹¬è€…ã€‚èª°ã‚ˆã‚Šé™ã‹ã«ã€èª°ã‚ˆã‚Šæ·±ãç‡ƒãˆã‚‹ã€‚ãã®è²¬ä»»æ„Ÿã¨è‘›è—¤ã®æ·±ã•ãŒã€æš—é»’é¨å£«ã®ç‰©èªã¨é‡ãªã‚Šã¾ã™ã€‚",
    traits:["èª å®Ÿã•","è²¬ä»»æ„Ÿ","å†…çœçš„","ä¸å±ˆ"], imgKey:"DarkKnight" },
  ESTP_TANK: { name:"Gunbreaker", nameJp:"ã‚¬ãƒ³ãƒ–ãƒ¬ã‚¤ã‚«ãƒ¼",icon:"ğŸ”«", color:"#c49a1a", role:"ã‚¿ãƒ³ã‚¯",
    desc:"çˆ†ç™ºçš„ãªåå¿œé€Ÿåº¦ã¨é‹­ã„åˆ¤æ–­åŠ›ã‚’æŒã¤å­¤é«˜ã®å®Ÿè·µè€…ã€‚è¤‡é›‘ãªã‚³ãƒ³ãƒœã‚’ç„¡è¨€ã§ã“ãªã™ã‚¬ãƒ³ãƒ–ãƒ¬ã‚¤ã‚«ãƒ¼ã¯ã€ã‚ãªãŸã®ã‚¯ãƒ¼ãƒ«ãªç‹¬ç«‹å¿ƒã¨å³èˆˆåŠ›ã‚’ä½“ç¾ã—ã¾ã™ã€‚",
    traits:["ç¬ç™ºåŠ›","ç‹¬ç«‹å¿ƒ","ç¾å®Ÿæ€è€ƒ","ã‚¹ã‚¿ã‚¤ãƒªãƒƒã‚·ãƒ¥"], imgKey:"Gunbreaker" },
  // â”€â”€â”€ HEALER â”€â”€â”€
  ENFJ_HEALER: { name:"Astrologian", nameJp:"å æ˜Ÿè¡“å¸«",  icon:"â­", color:"#d4af37", role:"ãƒ’ãƒ¼ãƒ©ãƒ¼",
    desc:"æ˜Ÿã®å°ãã¨ã¨ã‚‚ã«ä»²é–“ã‚’ç…§ã‚‰ã™ã‚«ãƒªã‚¹ãƒçš„ã‚µãƒãƒ¼ã‚¿ãƒ¼ã€‚æœ€é«˜ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ãƒãƒ•ã‚’å±Šã‘ã‚‹å¤©æ€§ã®æ”¯æ´è€…ã€‚ã‚ãªãŸã®ç›´æ„Ÿã¨å…±æ„ŸåŠ›ãŒã€æ˜Ÿã®åŠ›ã«å®¿ã‚Šã¾ã™ã€‚",
    traits:["å…±æ„ŸåŠ›","å…ˆè¦‹æ€§","ã‚«ãƒªã‚¹ãƒ","çŒ®èº«"], imgKey:"Astrologian" },
  ESFJ_HEALER: { name:"White Mage", nameJp:"ç™½é­”é“å£«",   icon:"âœ¨", color:"#b8e0e0", role:"ãƒ’ãƒ¼ãƒ©ãƒ¼",
    desc:"ä»²é–“ã‚’ç”Ÿã‹ã—ç¶šã‘ã‚‹ã“ã¨ã«å…¨åŠ›ã‚’æ³¨ãç´”ç²‹ãªå®ˆè­·è€…ã€‚ãƒãƒ¼ãƒ ãŒç”Ÿãã¦ã„ã‚‹é™ã‚Šæˆ¦ã„ã¯ç¶šãã€‚ã‚ãªãŸã®åˆ©ä»–ã®å¿ƒã®ç´”ç²‹ãªç™ºéœ²ãŒã€ç™½ã®é­”æ³•ã«å®¿ã‚Šã¾ã™ã€‚",
    traits:["åˆ©ä»–ä¸»ç¾©","è²¬ä»»æ„Ÿ","æ¸©ã‹ã•","å®Ÿè¡ŒåŠ›"], imgKey:"WhiteMage" },
  INFJ_HEALER: { name:"Scholar",    nameJp:"å­¦è€…",       icon:"ğŸ“š", color:"#4a8fb5", role:"ãƒ’ãƒ¼ãƒ©ãƒ¼",
    desc:"ãƒ•ã‚§ã‚¢ãƒªãƒ¼ã‚’å¾“ãˆã€å…ˆèª­ã¿ã¨äº‹å‰é…ç½®ã§å‘³æ–¹ã‚’å®ˆã‚‹æ´å¯Ÿè€…ã€‚èª°ã‚‚æ°—ã¥ã„ã¦ã„ãªã„æœªæ¥ã¸ã®å‚™ãˆã¨ã„ã†æ·±ã„å…ˆè¦‹æ€§ã¨ä½¿å‘½æ„ŸãŒã€å­¦è€…ã®é™ã‹ãªæˆ¦ç•¥ã«å®¿ã‚Šã¾ã™ã€‚",
    traits:["å…ˆè¦‹æ€§","æ€ã„ã‚„ã‚Š","ç·»å¯†ã•","ä½¿å‘½æ„Ÿ"], imgKey:"Scholar" },
  ISFJ_HEALER: { name:"Sage",       nameJp:"è³¢è€…",       icon:"ğŸ’", color:"#2a9a9a", role:"ãƒ’ãƒ¼ãƒ©ãƒ¼",
    desc:"æ”»æ’ƒã™ã‚‹ã“ã¨ã§ä»²é–“ã‚’ç™’ã™ã€é™ã‹ãªå®ˆè­·ã®å“²å­¦è€…ã€‚ç¸ã®ä¸‹ã§æ”¯ãˆç¶šã‘ã‚‹ã‚ãªãŸã®å¥‰ä»•ã®ç²¾ç¥ã¨æ…é‡ãªæ€ã„ã‚„ã‚ŠãŒã€è³¢è€…ã®é™ã‹ãªåŠ›ã¨ãªã‚Šã¾ã™ã€‚",
    traits:["å¥‰ä»•ç²¾ç¥","æ…é‡ã•","æ¸©ã‹ã•","é™ã‹ãªå¼·ã•"], imgKey:"Sage" },
  // â”€â”€â”€ MDPSï¼ˆè¿‘æ¥ç‰©ç†ï¼‰â”€â”€â”€
  ESTP_MDPS: { name:"Monk",        nameJp:"ãƒ¢ãƒ³ã‚¯",      icon:"ğŸ‘Š", color:"#d4821a", role:"è¿‘æ¥DPS",
    desc:"åœ§å€’çš„ãªé€£æ’ƒé€Ÿåº¦ã¨èº«ä½“ã®å‹•ãã§æ•µã‚’åˆ¶ã™ã‚‹æ ¼é—˜å®¶ã€‚åˆ¹é‚£ã®åˆ¤æ–­ã¨ä½“ã®åå¿œã§ç”Ÿãã‚‹ãƒ¢ãƒ³ã‚¯ã¯ã€ã‚ãªãŸã®çˆ†ç™ºçš„ãªè¡Œå‹•åŠ›ã¨ç¾å®Ÿã¸ã®ç›´æ„Ÿã‚’ä½“ç¾ã—ã¾ã™ã€‚",
    traits:["è¡Œå‹•åŠ›","ç¬ç™ºåŠ›","ç¾å®Ÿæ€è€ƒ","è‚‰ä½“æ´¾"], imgKey:"Monk" },
  ISTP_MDPS: { name:"Ninja",       nameJp:"å¿è€…",        icon:"ğŸŒ", color:"#3a9a6a", role:"è¿‘æ¥DPS",
    desc:"å†·é™ãªåˆ†æçœ¼ã¨ç¬æ™‚ã®çŠ¶æ³åˆ¤æ–­ã§è¯éº—ã«ç«‹ã¡å›ã‚‹å®Ÿè·µå®¶ã€‚è©¦è¡ŒéŒ¯èª¤ã‹ã‚‰æœ¬è³ªã‚’æ´ã‚€ã‚¯ãƒ¼ãƒ«ãªè¦³å¯Ÿçœ¼ã¨ç‹¬ç«‹ã—ãŸå®Ÿè¡ŒåŠ›ãŒã€å¿è€…ã®å°è¡“ã«å®¿ã‚Šã¾ã™ã€‚",
    traits:["å®Ÿè·µåŠ›","å†·é™ã•","å™¨ç”¨ã•","ç‹¬ç«‹å¿ƒ"], imgKey:"Ninja" },
  ENTP_MDPS: { name:"Reaper",      nameJp:"ãƒªãƒ¼ãƒ‘ãƒ¼",    icon:"âš”ï¸", color:"#8b4db5", role:"è¿‘æ¥DPS",
    desc:"æ­»éœŠã¨ã®å¥‘ç´„ã¨ã„ã†ç•°ç«¯ã®å“²å­¦ã§æˆ¦å ´ã‚’ã‹ãä¹±ã™è€…ã€‚æ—¢å­˜ã®æ ã‚’å£Šã™ã“ã¨ã‚’æã‚Œãªã„ã‚ãªãŸã®é©æ–°æ€§ã¨çŸ¥çš„æ¢æ±‚ãŒã€ãƒªãƒ¼ãƒ‘ãƒ¼ã®ç¦ã€…ã—ã„åŠ›ã¨å…±é³´ã—ã¾ã™ã€‚",
    traits:["é©æ–°æ€§","å‹ç ´ã‚Š","é ­è„³æˆ¦","å¼è«–å®¶"], imgKey:"Reaper" },
  ESTJ_MDPS: { name:"Samurai",     nameJp:"ä¾",          icon:"â›©ï¸", color:"#c8602a", role:"è¿‘æ¥DPS",
    desc:"åœ§å€’çš„ãªå‰£æŠ€ã¨æºã‚‹ããªã„ä¿¡å¿µã§é ‚ç‚¹ã‚’ç›®æŒ‡ã™æ±‚é“è€…ã€‚ä¾ã®ç ”ãæ¾„ã¾ã•ã‚ŒãŸä¸€åˆ€ã¯ã€ã‚ãªãŸã®ã€Œæ¥µã‚ã‚‹ã“ã¨ã¸ã®åŸ·ç€ã€ã¨æŒ‡æ®è€…çš„ãªè‡ªå·±å®Œçµæ€§ã‚’æ˜ ã—ã¾ã™ã€‚",
    traits:["æ±‚é“ç²¾ç¥","é›†ä¸­åŠ›","æ±ºæ–­åŠ›","å­¤é«˜"], imgKey:"Samurai" },
  INFP_MDPS: { name:"Viper",       nameJp:"ãƒ´ã‚¡ã‚¤ãƒ‘ãƒ¼",  icon:"ğŸ", color:"#6abf69", role:"è¿‘æ¥DPS",
    desc:"åŒå‰£ã‚’ç¸¦æ¨ªç„¡å°½ã«æ“ã‚Šã€ç‹¬è‡ªã®ãƒªã‚ºãƒ ã§æˆ¦å ´ã‚’èˆã†ã€‚æ—¢æˆæ¦‚å¿µã«ã¨ã‚‰ã‚ã‚Œãªã„ã‚ãªãŸã®è‡ªç”±ãªæ„Ÿæ€§ã¨ç†æƒ³ä¸»ç¾©ãŒã€ãƒ´ã‚¡ã‚¤ãƒ‘ãƒ¼ã®ã—ãªã‚„ã‹ãªæˆ¦é—˜ã‚¹ã‚¿ã‚¤ãƒ«ã«å®¿ã‚Šã¾ã™ã€‚",
    traits:["è‡ªç”±å¥”æ”¾","æ„Ÿæ€§","ç‹¬è‡ªã‚¹ã‚¿ã‚¤ãƒ«","ç†æƒ³ä¸»ç¾©"], imgKey:"Viper" },
  ISFP_MDPS: { name:"Dragoon",     nameJp:"ç«œé¨å£«",      icon:"ğŸ²", color:"#4169e1", role:"è¿‘æ¥DPS",
    desc:"å¤©é«˜ãè·³èºã—ã€å¤§åœ°ã‚’è²«ãæ§ã‚’æŒ¯ã‚‹ã†ç¾å­¦ã®ä½“ç¾è€…ã€‚ãã®ç¬é–“ã®ç¾ã—ã•ã¸ã®ã“ã ã‚ã‚Šã¨ç‹¬è‡ªã®æ„Ÿæ€§ãŒã€ç«œé¨å£«ã®é£›ç¿”ã¨é‡ãªã‚Šã¾ã™ã€‚",
    traits:["ç‹¬è‡ªæ€§","æ„Ÿæ€§è±Šã‹","æŠ€å·§","ç¾å­¦"], imgKey:"Dragoon" },
  // â”€â”€â”€ RDPSï¼ˆé éš”ç‰©ç†ï¼‰â”€â”€â”€
  ESFP_RDPS: { name:"Bard",        nameJp:"åŸéŠè©©äºº",    icon:"ğŸµ", color:"#7cba8a", role:"é éš”DPS",
    desc:"æ­Œã¨çŸ¢ã§å ´ã‚’å½©ã‚‹ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒŠãƒ¼ã€‚ã‚ãªãŸã¯äººãŒå–œã¶ç¬é–“ã«ç”ŸããŒã„ã‚’æ„Ÿã˜ã€æˆ¦å ´ã‚’åŠ‡å ´ã«å¤‰ãˆã‚‹å¤©æ‰ã€‚åŸéŠè©©äººã®ãƒ¡ãƒ­ãƒ‡ã‚£ãƒ¼ã¯ãã®è¡¨ç¾åŠ›ã®çµæ™¶ã§ã™ã€‚",
    traits:["ç¤¾äº¤æ€§","è¡¨ç¾åŠ›","é©å¿œåŠ›","å­˜åœ¨æ„Ÿ"], imgKey:"Bard" },
  ENFP_RDPS: { name:"Dancer",      nameJp:"è¸Šã‚Šå­",      icon:"ğŸ’ƒ", color:"#e87ca0", role:"é éš”DPS",
    desc:"å ´ã®ç©ºæ°—ã‚’èª­ã¿ã€ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã¨ã®çµ†ã§è¼ãè‡ªç”±ãªè¡¨ç¾è€…ã€‚äºˆæ¸¬ä¸èƒ½ãªç¾ã—ã•ã“ããŒæ­¦å™¨ã€‚ã‚ãªãŸã®è±Šã‹ãªæ„Ÿå—æ€§ã¨è‡ªç™ºçš„ãªã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒè¸Šã‚Šå­ã«å®¿ã‚Šã¾ã™ã€‚",
    traits:["å‰µé€ æ€§","è‡ªç™ºæ€§","å…±æ„ŸåŠ›","è¯ã‚„ã‹ã•"], imgKey:"Dancer" },
  ISTJ_RDPS: { name:"Machinist",   nameJp:"æ©Ÿå·¥å£«",      icon:"âš™ï¸", color:"#9a7a2a", role:"é éš”DPS",
    desc:"ã‚¬ã‚¸ã‚§ãƒƒãƒˆã¨ãƒ­ãƒœãƒƒãƒˆã‚’è‡ªç”±è‡ªåœ¨ã«æ“ã‚‹ç„¡å£ãªã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆã€‚è‡ªåˆ†ã ã‘ã®é“å…·ã¸ã®æ„›ç€ã¯ã‚ãªãŸã®ç¹Šç´°ãªæ„Ÿæ€§ã¨ç‹¬è‡ªã‚¹ã‚¿ã‚¤ãƒ«ã¸ã®ã“ã ã‚ã‚Šã‚’æ˜ ã—ã¾ã™ã€‚",
    traits:["ç‹¬è‡ªæ€§","æ„Ÿæ€§è±Šã‹","æŸ”è»Ÿæ€§","æŠ€å·§"], imgKey:"Machinist" },
  // â”€â”€â”€ CDPSï¼ˆé­”æ³•ãƒ»ã‚­ãƒ£ã‚¹ã‚¿ãƒ¼ï¼‰â”€â”€â”€
  INTJ_CDPS: { name:"Summoner",    nameJp:"å¬å–šå£«",      icon:"ğŸ‰", color:"#7a4fcf", role:"ã‚­ãƒ£ã‚¹ã‚¿ãƒ¼",
    desc:"å¹»ç£ã‚’æˆ¦ç•¥çš„ã«ä½¿ã„åˆ†ã‘ã€å£®å¤§ãªãƒ“ã‚¸ãƒ§ãƒ³ã®ã‚‚ã¨ã«æˆ¦ã†çŸ¥ã®æ”¯é…è€…ã€‚å…¨ä½“ã‚’è¦‹é€šã™ç›®ã¨é•·æœŸçš„è¨ˆç”»æ€§ãŒå¬å–šå£«ã®åŠ›ã®æºã€‚å­¤é«˜ã®çŸ¥ç•¥å®¶ã€‚",
    traits:["æˆ¦ç•¥æ€è€ƒ","ç‹¬ç«‹å¿ƒ","æ´å¯ŸåŠ›","å®Œç’§ä¸»ç¾©"], imgKey:"Summoner" },
  INTP_CDPS: { name:"Black Mage",  nameJp:"é»’é­”é“å£«",    icon:"ğŸ”¥", color:"#5050c8", role:"ã‚­ãƒ£ã‚¹ã‚¿ãƒ¼",
    desc:"å®šç‚¹è© å”±ã¨ã„ã†æ¥µè‡´ã¸ã®ã“ã ã‚ã‚Šã€‚åŠ¹ç‡ã‚ˆã‚ŠçœŸç†ã‚’æ±‚ã‚ã‚‹ã‚ãªãŸã®ã€ŒãŸã ç´”ç²‹ã«æ¥µã‚ãŸã„ã€ã¨ã„ã†æ¢æ±‚å¿ƒãŒã€é»’é­”é“å£«ã®ç ´å£Šçš„ç«åŠ›ã«å®¿ã‚Šã¾ã™ã€‚",
    traits:["æ¢æ±‚å¿ƒ","è«–ç†æ€§","é›†ä¸­åŠ›","ç‹¬è‡ªè¦–ç‚¹"], imgKey:"BlackMage" },
  INFP_CDPS: { name:"Red Mage",    nameJp:"èµ¤é­”é“å£«",    icon:"âš—ï¸", color:"#c04070", role:"ã‚­ãƒ£ã‚¹ã‚¿ãƒ¼",
    desc:"é­”æ³•ã¨å‰£ã¨ã„ã†ç›¸åã™ã‚‹ã‚‚ã®ã‚’èåˆã•ã›ãŸç†æƒ³ä¸»ç¾©è€…ã€‚å¯¾ç«‹ã™ã‚‹ã‚‚ã®ã®ä¸­ã«ç¾ã‚’è¦‹ã¤ã‘ã‚‹ã‚ãªãŸã®è©©çš„ãªå†…é¢ä¸–ç•ŒãŒã€èµ¤é­”é“å£«ã®ç™½ã¨é»’ã®å‡è¡¡ã«å®¿ã‚Šã¾ã™ã€‚",
    traits:["ç†æƒ³ä¸»ç¾©","å‡è¡¡æ„Ÿè¦š","ç‹¬å‰µæ€§","èª å®Ÿã•"], imgKey:"RedMage" },
  ENTP_CDPS: { name:"Pictomancer", nameJp:"ãƒ”ã‚¯ãƒˆãƒãƒ³ã‚µãƒ¼",icon:"ğŸ¨", color:"#e06090", role:"ã‚­ãƒ£ã‚¹ã‚¿ãƒ¼",
    desc:"çµµç”»ã®é­”åŠ›ã§æˆ¦å ´ã‚’å¡—ã‚Šæ›¿ãˆã‚‹å‰µé€ ã®ç•°ç«¯è€…ã€‚ã‚ãªãŸã®åº•çŸ¥ã‚Œãªã„ç™ºæƒ³åŠ›ã¨ã€Œèª°ã‚‚æ€ã„ã¤ã‹ãªã„ã“ã¨ã‚’ã‚„ã‚‹ã€ã¨ã„ã†è¡å‹•ãŒã€ãƒ”ã‚¯ãƒˆãƒãƒ³ã‚µãƒ¼ã®é­”æ³•ç­†ã«å®¿ã‚Šã¾ã™ã€‚",
    traits:["å‰µé€ æ€§","é©æ–°æ€§","è¡¨ç¾åŠ›","è‡ªç”±"], imgKey:"Pictomancer" },
};

// MBTIã‚¿ã‚¤ãƒ—ãŒåŒã˜ã§ã‚‚ãƒ­ãƒ¼ãƒ«ãŒé•ãˆã°åˆ¥ã‚¸ãƒ§ãƒ–
// ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å„ªå…ˆé †ä½ãƒãƒƒãƒ—ï¼ˆåŒMBTIã§å¸Œæœ›ãƒ­ãƒ¼ãƒ«ãŒãªã„å ´åˆï¼‰
const fallbackOrder = {
  TANK:   ['TANK','HEALER','MDPS','RDPS','CDPS'],
  HEALER: ['HEALER','TANK','CDPS','RDPS','MDPS'],
  MDPS:   ['MDPS','RDPS','CDPS','TANK','HEALER'],
  RDPS:   ['RDPS','MDPS','CDPS','HEALER','TANK'],
  CDPS:   ['CDPS','RDPS','MDPS','HEALER','TANK'],
};

// MBTIç›¸æ€§ãƒãƒƒãƒ—ï¼ˆç›¸æ€§ç†è«–ãƒ™ãƒ¼ã‚¹: è£œå®Œãƒ»åŒå¯¾ãƒ»åŒä¸€ã‚°ãƒ«ãƒ¼ãƒ—ï¼‰
// å„MBTIã«å¯¾ã—ã¦ç›¸æ€§ã®è‰¯ã„3ã¤ã®MBTIã‚­ãƒ¼(jobMapã®ã‚­ãƒ¼)ã¨ä¸€è¨€ã‚³ãƒ¡ãƒ³ãƒˆã‚’å®šç¾©
const compatMap = {
  // TANK
  ENTJ_TANK: [
    { key:'INFP_MDPS',  comment:'ã‚ãªãŸã®æŒ‡æ®åŠ›ãŒã€ãƒ´ã‚¡ã‚¤ãƒ‘ãƒ¼ã®è‡ªç”±ãªå‰£èˆã‚’å®ˆã‚‹ç›¾ã¨ãªã‚‹ã€‚æ­£åå¯¾ã ã‹ã‚‰ã“ãæœ€å¼·ã®ã‚³ãƒ³ãƒ“ã€‚' },
    { key:'INFP_CDPS',  comment:'ç†æƒ³ã‚’èªã‚‹èµ¤é­”é“å£«ã¨ã€ãã‚Œã‚’å®Ÿç¾ã™ã‚‹æˆ¦ç•¥å®¶ã€‚ç™½ã¨é»’ã®å‡è¡¡ã‚’ã¨ã‚‚ã«å®ˆã‚‹ã€‚' },
    { key:'ENFJ_HEALER',comment:'ãƒªãƒ¼ãƒ€ãƒ¼åŒå£«ã®å…±é³´ã€‚å æ˜Ÿè¡“å¸«ã®ç›´æ„ŸãŒã‚ãªãŸã®æ±ºæ–­ã‚’æ˜Ÿã§å°ã„ã¦ãã‚Œã‚‹ã€‚' },
  ],
  ESTJ_TANK: [
    { key:'INFP_MDPS',  comment:'è¦å¾‹ã¨è‡ªç”±ã®è£œå®Œé–¢ä¿‚ã€‚ã‚ãªãŸã®å®‰å®šã—ãŸé˜²å¾¡ç·šãŒãƒ´ã‚¡ã‚¤ãƒ‘ãƒ¼ã®å¥”æ”¾ãªæ”»ã‚ã‚’æ´»ã‹ã™ã€‚' },
    { key:'ISFP_MDPS',  comment:'ç„¡å£ãªç«œé¨å£«ã®ç¾å­¦ã‚’ã€ã‚ãªãŸã®åŠ›å¼·ã„ç›¾ãŒé™ã‹ã«æ”¯ãˆã‚‹ã€‚è¨€è‘‰ã¯ä¸è¦ã€‚' },
    { key:'ISFJ_HEALER',comment:'å …å®Ÿãªè€…åŒå£«ã®æœ€å¼·ã‚¿ãƒƒã‚°ã€‚è³¢è€…ã®é™ã‹ãªå›å¾©ãŒã‚ãªãŸã®ç„¡æ•µæ„Ÿã‚’ã•ã‚‰ã«é«˜ã‚ã‚‹ã€‚' },
  ],
  ISTJ_TANK: [
    { key:'ENFP_RDPS',  comment:'è¸Šã‚Šå­ã®è¯ã‚„ã‹ã•ã‚’å½±ã§å®ˆã‚‹å½±ã®å®ˆè­·è€…ã€‚æ­£åå¯¾ã®å­˜åœ¨ãŒãŠäº’ã„ã‚’å®Œæˆã•ã›ã‚‹ã€‚' },
    { key:'ESFP_RDPS',  comment:'åŸéŠè©©äººã®ãƒãƒ•ãŒã‚ãªãŸã®å …å®Ÿãªå®ˆã‚Šã«å½©ã‚Šã‚’æ·»ãˆã‚‹ã€‚å½±ã¨å…‰ã®å…±æ¼”ã€‚' },
    { key:'ESTJ_MDPS',  comment:'åŒã˜å‰£ã®é“ã‚’ç•°ãªã‚‹å“²å­¦ã§æ­©ã‚€è€…ã€‚ä¾ã®é«˜ã¿ã¸ã®åŸ·ç€ãŒã‚ãªãŸã®è²¬ä»»æ„Ÿã‚’é¼“èˆã™ã‚‹ã€‚' },
  ],
  ESTP_TANK: [
    { key:'ENFJ_HEALER',comment:'å­¤é«˜ã®ã‚¬ãƒ³ãƒ–ãƒ¬ã‚¤ã‚«ãƒ¼ã«å æ˜Ÿè¡“å¸«ã®æ˜Ÿæ˜ã‹ã‚ŠãŒé™ã‚Šæ³¨ãã€‚è¨€è‘‰å°‘ãªãã¨ã‚‚æ¯ã¯åˆã†ã€‚' },
    { key:'ESFJ_HEALER',comment:'ç™½é­”é“å£«ã®æ¸©ã‹ã„å›å¾©ãŒã‚¯ãƒ¼ãƒ«ãªã‚ãªãŸã®èƒŒä¸­ã‚’ç¢ºã‹ã«å®ˆã£ã¦ãã‚Œã‚‹ã€‚' },
    { key:'ESTP_MDPS',  comment:'åŒã˜ç¬é–“ã‚’ç”Ÿãã‚‹å®Ÿè·µè€…åŒå£«ã€‚ãƒ¢ãƒ³ã‚¯ã®çˆ†ç™ºåŠ›ã¨ã‚ãªãŸã®åˆ¤æ–­åŠ›ãŒå ´ã‚’æ”¯é…ã™ã‚‹ã€‚' },
  ],
  // HEALER
  ENFJ_HEALER: [
    { key:'ISTJ_TANK',  comment:'æš—é»’é¨å£«ã®å­¤ç‹¬ãªè²¬ä»»æ„Ÿã‚’ã€ã‚ãªãŸã®æ˜Ÿã®å…‰ãŒç…§ã‚‰ã—å°ãã€‚é™ã‹ãªçµ†ã€‚' },
    { key:'ESTP_TANK',  comment:'ã‚¬ãƒ³ãƒ–ãƒ¬ã‚¤ã‚«ãƒ¼ã®çˆ†ç™ºçš„ãªç›¾ã‚’æ”¯ãˆã‚‹ã‚«ãƒªã‚¹ãƒãƒ’ãƒ¼ãƒ©ãƒ¼ã€‚ç„¡è¨€ã®ã‚·ãƒŠã‚¸ãƒ¼ãŒç”Ÿã¾ã‚Œã‚‹ã€‚' },
    { key:'INTJ_CDPS',  comment:'å¬å–šå£«ã®å†·å¾¹ãªçŸ¥ç•¥ã«ã‚ãªãŸã®æ¸©ã‹ã„å…ˆè¦‹æ€§ãŒåŠ ã‚ã‚‹ã¨ã€ãƒ‘ãƒ¼ãƒ†ã‚£ãŒå®Œç’§ã«ãªã‚‹ã€‚' },
  ],
  ESFJ_HEALER: [
    { key:'ISTJ_TANK',  comment:'å …å®Ÿãªæš—é»’é¨å£«ã¨ã‚ãªãŸã®æ¸©ã‹ãªå›å¾©ã¯ã€ã¾ã•ã«é‰„å£ã®å®ˆè­·ã‚³ãƒ³ãƒ“ã€‚' },
    { key:'ESTP_TANK',  comment:'ç„¡å£ãªã‚¬ãƒ³ãƒ–ãƒ¬ã‚¤ã‚«ãƒ¼ã‚’ãã£ã¨æ”¯ãˆã‚‹æ¯æ€§ã€‚ç›¸æ‰‹ã¯ç„¡è¨€ã§ã‚‚æ„Ÿè¬ã—ã¦ã„ã‚‹ã€‚' },
    { key:'INTJ_CDPS',  comment:'è«–ç†ã®å¬å–šå£«ã«æ„Ÿæƒ…ã®ç™½é­”é“å£«ã€‚å¯¾æ¥µãŒè£œã„åˆã£ã¦åˆã‚ã¦ãƒ‘ãƒ¼ãƒ†ã‚£ã¯å®Œæˆã™ã‚‹ã€‚' },
  ],
  INFJ_HEALER: [
    { key:'ESTP_MDPS',  comment:'ãƒ¢ãƒ³ã‚¯ã®è¡å‹•çš„ãªçªæ’ƒã‚’å…ˆèª­ã¿ã—ã¦å®ˆã‚Œã‚‹ã®ã¯ã€æœªæ¥ãŒè¦‹ãˆã‚‹å­¦è€…ã ã‘ã€‚' },
    { key:'ENTP_MDPS',  comment:'ãƒªãƒ¼ãƒ‘ãƒ¼ã®äºˆæ¸¬ä¸èƒ½ãªå‹•ãã‚’ã™ã¹ã¦å¯ŸçŸ¥ã™ã‚‹ã®ãŒå­¦è€…ã®ä½¿å‘½ã€‚æ··æ²Œã‚’é™ã‹ã«åˆ¶å¾¡ã™ã‚‹ã€‚' },
    { key:'ENTJ_TANK',  comment:'ãƒŠã‚¤ãƒˆã®å¤§å±€çš„æŒ‡æ®ã¨å­¦è€…ã®ç·»å¯†ãªäº‹å‰æº–å‚™ãŒé‡ãªã‚‹ã¨ç„¡æ•µã®ãƒ©ã‚¤ãƒ³ãŒç”Ÿã¾ã‚Œã‚‹ã€‚' },
  ],
  ISFJ_HEALER: [
    { key:'ESTJ_TANK',  comment:'æˆ¦å£«ã®è±ªå¿«ãªè‡ªå‚·å›å¾©ã‚’æ¸©ã‹ããƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹é™ã‹ãªå®ˆè­·è€…ã€‚ç„¡ç†ã•ã›ãªã„ã‚ˆã†è¦‹å®ˆã‚‹ã€‚' },
    { key:'ENTJ_TANK',  comment:'ãƒŠã‚¤ãƒˆã®ä½¿å‘½æ„Ÿã«è³¢è€…ã®å¥‰ä»•ã®å¿ƒãŒé‡ãªã‚‹ã€‚å®ˆè­·ã¨å›å¾©ã®ç¾ã—ã„é€£é–ã€‚' },
    { key:'INTP_CDPS',  comment:'é»’é­”é“å£«ã®è‡ªç”±ãªå®šç‚¹è© å”±ã‚’èª°ã‚ˆã‚Šä¸Šæ‰‹ã«æ”¯ãˆã‚‰ã‚Œã‚‹ã®ã¯ã€ã‚ãªãŸã®æ…é‡ãªå…ˆèª­ã¿ã ã‘ã€‚' },
  ],
  // MDPS
  ESTP_MDPS: [
    { key:'INFJ_HEALER',comment:'å­¦è€…ã®å…ˆèª­ã¿ãŒã‚ãªãŸã®çªé€²ã‚’å®Œç’§ã«ã‚«ãƒãƒ¼ã€‚æš´ã‚Œã‚‹ã»ã©ã«å®ˆã‚‰ã‚Œã¦ã„ã‚‹ã€‚' },
    { key:'ISFJ_HEALER',comment:'è³¢è€…ã®é™ã‹ãªè¦‹å®ˆã‚ŠãŒã€ã‚ãªãŸã®å…¨åŠ›ãƒ€ãƒƒã‚·ãƒ¥ã‚’å®‰å¿ƒã«å¤‰ãˆã¦ãã‚Œã‚‹ã€‚' },
    { key:'INTJ_CDPS',  comment:'å¬å–šå£«ã®å†·é™ãªæˆ¦ç•¥çœ¼ãŒã‚ãªãŸã®çˆ†ç™ºçš„DPSã‚’æœ€å¤§é™ã«æ´»ã‹ã™é…ç½®ã‚’ä½œã‚‹ã€‚' },
  ],
  ISTP_MDPS: [
    { key:'ENFJ_HEALER',comment:'å æ˜Ÿè¡“å¸«ã®ã‚«ãƒªã‚¹ãƒãƒãƒ•ãŒã€å¿è€…ã®ç²¾å¯†ãªç«‹ã¡å›ã‚Šã‚’ã•ã‚‰ã«è¼ã‹ã›ã‚‹ã€‚' },
    { key:'ESFJ_HEALER',comment:'ç™½é­”é“å£«ã®å®‰å®šã—ãŸå›å¾©ãŒã‚ãªãŸã®å­¤é«˜ã®é›†ä¸­ã‚’é€”åˆ‡ã‚Œã•ã›ãªã„ã€‚' },
    { key:'ENTP_CDPS',  comment:'ãƒ”ã‚¯ãƒˆãƒãƒ³ã‚µãƒ¼ã®å‰è¡›èŠ¸è¡“çš„ãªæ”»æ’ƒã¨ã‚ãªãŸã®ã‚¯ãƒ¼ãƒ«ãªå®Ÿè·µåŠ›ãŒå¥‡å¦™ã«å™›ã¿åˆã†ã€‚' },
  ],
  ENTP_MDPS: [
    { key:'INFJ_HEALER',comment:'å­¦è€…ã®é™ã‹ãªèª­ã¿ãŒã€ãƒªãƒ¼ãƒ‘ãƒ¼ã®å‹ç ´ã‚Šãªå‹•ãã‚’é™°ã‹ã‚‰å®Œç’§ã«è£œä½ã™ã‚‹ã€‚' },
    { key:'ISFJ_HEALER',comment:'è³¢è€…ã®å¿è€ã¨æ¸©ã‹ã•ãŒã€ã‚ãªãŸã®ç ´å¤©è’ãªã‚¹ã‚¿ã‚¤ãƒ«ã‚’æ”¯ãˆã‚‹ç¸ã®ä¸‹ã®æŸ±ã€‚' },
    { key:'INTJ_CDPS',  comment:'åŒã˜ã€ŒçŸ¥ã€ã®ä½¿ã„æ‰‹ã¨ã—ã¦å…±é³´ã™ã‚‹ã€‚å¬å–šå£«ã®æˆ¦ç•¥ã¨ãƒªãƒ¼ãƒ‘ãƒ¼ã®æ··ä¹±ãŒä¸–ç•Œã‚’æºã‚‹ãŒã™ã€‚' },
  ],
  ESTJ_MDPS: [
    { key:'INFP_MDPS',  comment:'å­¤é«˜ã®ä¾ã¨å¤¢è¦‹ã‚‹ãƒ´ã‚¡ã‚¤ãƒ‘ãƒ¼ã€‚æ±‚é“è€…ã¨è‡ªç”±äººã®å¯¾æ¯”ãŒæˆ¦å ´ã«è©©ã‚’ç”Ÿã‚€ã€‚' },
    { key:'ISFP_MDPS',  comment:'åŒã˜å‰£ã®é“ã§ã‚‚ç¾å­¦ãŒé•ã†ã€‚ç«œé¨å£«ã®æ„Ÿæ€§ãŒä¾ã®ç²¾ç¥ã‚’è±Šã‹ã«ã™ã‚‹ã€‚' },
    { key:'ENFJ_HEALER',comment:'å æ˜Ÿè¡“å¸«ã®ã‚«ãƒªã‚¹ãƒã¨ã‚ãªãŸã®æ±ºæ–­åŠ›ãŒåˆã‚ã•ã‚‹ã¨ã€ãƒ‘ãƒ¼ãƒ†ã‚£å…¨ä½“ãŒå‹•ãå‡ºã™ã€‚' },
  ],
  INFP_MDPS: [
    { key:'ENTJ_TANK',  comment:'ãƒŠã‚¤ãƒˆã®å¼·å›ºãªæŒ‡æ®ãŒãƒ´ã‚¡ã‚¤ãƒ‘ãƒ¼ã®è‡ªç”±ãªå‰£èˆã‚’æœ€å¤§é™ã«æ´»ã‹ã—ã¦ãã‚Œã‚‹ã€‚' },
    { key:'ESTJ_TANK',  comment:'æˆ¦å£«ã®æºã‚‹ããªã„ç›¾ãŒã‚ãªãŸã®å¤¢ã‚’ç¾å®Ÿã«å¤‰ãˆã‚‹åœŸå°ã¨ãªã‚‹ã€‚' },
    { key:'INFP_CDPS',  comment:'åŒã˜é­‚ã‚’æŒã¤è€…ã€‚èµ¤é­”é“å£«ã®å‡è¡¡ã™ã‚‹å“²å­¦ã¨ãƒ´ã‚¡ã‚¤ãƒ‘ãƒ¼ã®è‡ªç”±ãŒè©©çš„ã«å…±é³´ã™ã‚‹ã€‚' },
  ],
  ISFP_MDPS: [
    { key:'ESTJ_TANK',  comment:'ç„¡éª¨ãªæˆ¦å£«ãŒã‚ãªãŸã®ç¹Šç´°ãªç¾å­¦ã‚’é»™ã£ã¦å®ˆã‚Šç¶šã‘ã¦ãã‚Œã‚‹ã€‚è¨€è‘‰ã¯ã„ã‚‰ãªã„ã€‚' },
    { key:'ESTJ_MDPS',  comment:'ä¾ã®å‰›ã¨ãƒ‰ãƒ©ã‚°ãƒ¼ãƒ³ã®ç¾ã€‚ç•°ãªã‚‹ç¾å­¦ãŒé«˜ã¿ã§äº¤ã‚ã‚‹ç¬é–“ã‚’ç›®æŒ‡ã™åŒå¿—ã€‚' },
    { key:'ISFJ_HEALER',comment:'åŒã˜å†…çœçš„ãªé­‚ã‚’æŒã¤å®ˆã‚Šæ‰‹åŒå£«ã€‚è³¢è€…ã®é™ã‹ãªå›å¾©ãŒã‚ãªãŸã®é£›ç¿”ã‚’æ”¯ãˆã‚‹ã€‚' },
  ],
  // RDPS
  ESFP_RDPS: [
    { key:'ISTJ_TANK',  comment:'æš—é»’é¨å£«ã®å½±ãŒã‚ãªãŸã®æ­Œã«æ·±ã¿ã‚’ä¸ãˆã‚‹ã€‚å…‰ã¨é—‡ã®å…±æ¼”ãŒæˆ¦å ´ã‚’èˆå°ã«å¤‰ãˆã‚‹ã€‚' },
    { key:'INTJ_CDPS',  comment:'å¬å–šå£«ã®å†·é™ãªå¸ä»¤ãŒã‚ãªãŸã®è¡¨ç¾åŠ›ã«æ„å‘³ã¨æ–¹å‘æ€§ã‚’ä¸ãˆã¦ãã‚Œã‚‹ã€‚' },
    { key:'INFJ_HEALER',comment:'å­¦è€…ã®å…ˆèª­ã¿ãƒãƒªã‚¢ãŒã€åŸéŠè©©äººã®è‡ªç”±ãªå‹•ãå›ã‚Šã‚’å®Œå…¨ã«ã‚«ãƒãƒ¼ã™ã‚‹ã€‚' },
  ],
  ENFP_RDPS: [
    { key:'ISTJ_TANK',  comment:'æš—é»’é¨å£«ã®é™ã‹ãªèª å®Ÿã•ãŒã€è¸Šã‚Šå­ã®è¯ã‚„ã‹ã•ã‚’åœ°ã«è¶³ã¤ã‹ã›ã¦ãã‚Œã‚‹ã€‚' },
    { key:'INTJ_CDPS',  comment:'å¬å–šå£«ã®ç·»å¯†ãªæˆ¦ç•¥ãŒãƒ€ãƒ³ã‚µãƒ¼ã®ç›´æ„Ÿçš„ãªãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼é¸ã³ã‚’å®Œç’§ã«æ´»ã‹ã™ã€‚' },
    { key:'INFJ_HEALER',comment:'å­¦è€…ã®æ·±ã„æ´å¯ŸãŒã‚ãªãŸã®å…±æ„ŸåŠ›ã¨å…±é³´ã—ã¦ã€æœ€é«˜ã®ãƒ’ãƒ¼ãƒ«ï¼†ã‚¢ã‚·ã‚¹ãƒˆãŒç”Ÿã¾ã‚Œã‚‹ã€‚' },
  ],
  ISTJ_RDPS: [
    { key:'ESTJ_TANK',  comment:'æˆ¦å£«ã®å®‰å®šã—ãŸå£ãŒã‚ãªãŸã®ã‚¬ã‚¸ã‚§ãƒƒãƒˆå±•é–‹ã®è‡ªç”±ã‚’ä¿éšœã—ã¦ãã‚Œã‚‹ã€‚' },
    { key:'ENFJ_HEALER',comment:'å æ˜Ÿè¡“å¸«ã®æ˜Ÿã®ãƒãƒ•ãŒæ©Ÿå·¥å£«ã®ç²¾å¯†ãªå°„æ’ƒã‚’ã•ã‚‰ã«è¼ã‹ã›ã‚‹ã€‚' },
    { key:'INTP_CDPS',  comment:'é»’é­”é“å£«ã®æ¢æ±‚å¿ƒã¨æ©Ÿå·¥å£«ã®æŠ€è¡“æ„›ãŒã€ç„¡è¨€ã®ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼åŒç›Ÿã‚’çµã¶ã€‚' },
  ],
  // CDPS
  INTJ_CDPS: [
    { key:'ESFP_RDPS',  comment:'åŸéŠè©©äººã®è¡¨ç¾åŠ›ãŒå¬å–šå£«ã®å­¤é«˜ã®æˆ¦ç•¥ã«å½©ã‚Šã‚’æ·»ãˆã‚‹ã€‚çŸ¥ã¨æ„Ÿæ€§ã®å®Œç’§ãªèåˆã€‚' },
    { key:'ENFP_RDPS',  comment:'è¸Šã‚Šå­ã®ç›´æ„Ÿã¨å¬å–šå£«ã®è¨ˆç®—ãŒçµ„ã¿åˆã‚ã•ã‚‹ã¨ã€äºˆæ¸¬ä¸èƒ½ãªæœ€å¼·ãƒ‘ãƒ¼ãƒ†ã‚£ãŒç”Ÿã¾ã‚Œã‚‹ã€‚' },
    { key:'ESTP_MDPS',  comment:'ãƒ¢ãƒ³ã‚¯ã®çˆ†ç™ºåŠ›ã‚’å¬å–šå£«ãŒæˆ¦ç•¥çš„ã«é…ç½®ã™ã‚‹ã€‚çŸ¥æ€§ãŒè‚‰ä½“ã‚’æœ€å¤§é™ã«ä½¿ã†ã€‚' },
  ],
  INTP_CDPS: [
    { key:'ESFJ_HEALER',comment:'ç™½é­”é“å£«ã®æ¸©ã‹ã¿ãŒé»’é­”é“å£«ã®å­¤ç‹¬ãªæ¢æ±‚ã‚’é™ã‹ã«æ”¯ãˆã¦ãã‚Œã‚‹ã€‚' },
    { key:'ISTJ_RDPS',  comment:'æ©Ÿå·¥å£«ã®æŠ€è¡“æ„›ã¨é»’é­”é“å£«ã®ç†è«–æ¢æ±‚ã€‚ç„¡è¨€ã§åˆ†ã‹ã‚Šåˆãˆã‚‹ãƒ¢ãƒã¥ãã‚ŠåŒç›Ÿã€‚' },
    { key:'ENFJ_HEALER',comment:'å æ˜Ÿè¡“å¸«ã®ã‚«ãƒªã‚¹ãƒãŒé»’é­”é“å£«ã®å®šç‚¹è© å”±ã‚’å®ˆã‚‹æœ€é«˜ã®ç’°å¢ƒã‚’æ•´ãˆã¦ãã‚Œã‚‹ã€‚' },
  ],
  INFP_CDPS: [
    { key:'ENTJ_TANK',  comment:'ãƒŠã‚¤ãƒˆã®å¼·å›ºãªæ„å¿—ãŒèµ¤é­”é“å£«ã®ç†æƒ³ä¸»ç¾©ã‚’ç¾å®Ÿã«å¼•ãæˆ»ã—ã¦ãã‚Œã‚‹ã€‚æ­£åå¯¾ã®å®Œç’§ãªè£œå®Œã€‚' },
    { key:'INFP_MDPS',  comment:'åŒã˜é­‚ã‚’æŒã¤ãƒ´ã‚¡ã‚¤ãƒ‘ãƒ¼ã¨èµ¤é­”é“å£«ã€‚è‡ªç”±ã¨å‡è¡¡ã€äºŒã¤ã®è©©ãŒæˆ¦å ´ã«éŸ¿ãã€‚' },
    { key:'ISFJ_HEALER',comment:'è³¢è€…ã®é™ã‹ãªå¥‰ä»•ãŒã‚ãªãŸã®ç†æƒ³ã®ä¸–ç•Œã‚’å„ªã—ãå®ˆã‚Šç¶šã‘ã¦ãã‚Œã‚‹ã€‚' },
  ],
  ENTP_CDPS: [
    { key:'ISTP_MDPS',  comment:'å¿è€…ã®ã‚¯ãƒ¼ãƒ«ãªæŠ€è¡“ã¨ãƒ”ã‚¯ãƒˆãƒãƒ³ã‚µãƒ¼ã®å¥”æ”¾ãªç™ºæƒ³ãŒå¥‡è·¡çš„ãªã‚³ãƒ³ãƒ“ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç”Ÿã‚€ã€‚' },
    { key:'INFJ_HEALER',comment:'å­¦è€…ã®ç·»å¯†ãªèª­ã¿ãŒã‚ãªãŸã®äºˆæ¸¬ä¸èƒ½ãªæ”»æ’ƒã‚’ã™ã¹ã¦ã‚«ãƒãƒ¼ã—ã¦ãã‚Œã‚‹å”¯ä¸€ã®å­˜åœ¨ã€‚' },
    { key:'ISTJ_TANK',  comment:'æš—é»’é¨å£«ã®è²¬ä»»æ„Ÿã¨ã„ã†åœŸå°ãŒã‚ã£ã¦åˆã‚ã¦ã€ãƒ”ã‚¯ãƒˆãƒãƒ³ã‚µãƒ¼ã¯æ€ã†å­˜åˆ†ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’æã‘ã‚‹ã€‚' },
  ],
};

function renderCompat(jobKey) {
  const compats = compatMap[jobKey];
  if (!compats) return;
  const listEl = document.getElementById('compat-list');
  const roleColors = { ã‚¿ãƒ³ã‚¯:'#5b8dd9', ãƒ’ãƒ¼ãƒ©ãƒ¼:'#7cba8a', 'è¿‘æ¥DPS':'#c04b1a', 'é éš”DPS':'#c49a1a', ã‚­ãƒ£ã‚¹ã‚¿ãƒ¼:'#7a4fcf' };
  listEl.innerHTML = compats.map((c, i) => {
    const job = jobMap[c.key];
    if (!job) return '';
    const mbti = c.key.split('_')[0];
    const roleColor = roleColors[job.role] || '#c9a84c';
    const imgHtml = job.imgKey && JOB_IMAGES[job.imgKey]
      ? `<img class="compat-img" src="${JOB_IMAGES[job.imgKey]}" alt="${job.nameJp}">`
      : `<div class="compat-icon-fallback">${job.icon}</div>`;
    const rank = ['Best Match', 'Great Match', 'Good Match'][i];
    return `
      <div class="compat-card">
        <div class="compat-img-wrap">${imgHtml}</div>
        <div class="compat-info">
          <div class="compat-mbti">${mbti}</div>
          <div class="compat-name">${job.name}</div>
          <div class="compat-name-jp">${job.nameJp}</div>
          <div class="compat-comment">${c.comment}</div>
        </div>
        <div class="compat-badge" style="color:${roleColor};border-color:${roleColor};opacity:0.8">${rank}</div>
      </div>`;
  }).join('');
}


function hamming(a, b) {
  let d = 0;
  for (let i = 0; i < Math.min(a.length, b.length); i++) if (a[i] !== b[i]) d++;
  d += Math.abs(a.length - b.length);
  return d;
}

const roleDist = {
  TANK:   { TANK:0, HEALER:1, MDPS:2, RDPS:2, CDPS:3 },
  HEALER: { TANK:1, HEALER:0, MDPS:2, RDPS:1, CDPS:2 },
  MDPS:   { TANK:2, HEALER:2, MDPS:0, RDPS:1, CDPS:1 },
  RDPS:   { TANK:2, HEALER:1, MDPS:1, RDPS:0, CDPS:1 },
  CDPS:   { TANK:3, HEALER:2, MDPS:1, RDPS:1, CDPS:0 },
};

function findJob(mbti, role, axisScores) {
  // åŒMBTIã§è¤‡æ•°ãƒ­ãƒ¼ãƒ«ã‚’æŒã¤å ´åˆã€ãƒ­ãƒ¼ãƒ«ã‚¹ã‚³ã‚¢ã®softmaxã§æŒ¯ã‚Šåˆ†ã‘ã‚‹
  // (ISTPâ†’Ninja/Gunbreaker, ENTJâ†’Paladin/Samurai, ENTPâ†’Reaper/Pictomancer)
  const mbtiRoles = Object.keys(jobMap)
    .filter(k => k.startsWith(mbti + '_'))
    .map(k => k.split('_')[1]);

  if (mbtiRoles.length === 1) {
    const r = mbtiRoles[0];
    return { job: jobMap[`${mbti}_${r}`], roleUsed: r };
  }

  if (mbtiRoles.length > 1 && axisScores) {
    const scores = determineRoleScores(axisScores);
    // ã“ã®MBTIãŒæŒã¤ãƒ­ãƒ¼ãƒ«ã®ã‚¹ã‚³ã‚¢ã§softmaxï¼ˆæ¸©åº¦0.10ï¼‰
    const temp = 0.10;
    const vals = mbtiRoles.map(r => scores[r] ?? -999);
    const maxV = Math.max(...vals);
    const exps = vals.map(v => Math.exp((v - maxV) / temp));
    const total = exps.reduce((a, b) => a + b, 0);

    // æ±ºå®šçš„PRNGã§ã‚·ãƒ¼ãƒ‰ï¼ˆåŒã˜å›ç­”â†’åŒã˜çµæœï¼‰
    const seedStr = `${mbti}|${axisScores.EI.toFixed(4)}|${axisScores.SN.toFixed(4)}|${axisScores.TF.toFixed(4)}|${axisScores.JP.toFixed(4)}`;
    let h = 2166136261 >>> 0;
    for (let i = 0; i < seedStr.length; i++) {
      h ^= seedStr.charCodeAt(i);
      h = Math.imul(h, 16777619) >>> 0;
    }
    const rVal = ((h >>> 0) % 1000000) / 1000000.0 * total;
    let acc = 0;
    for (let i = 0; i < mbtiRoles.length; i++) {
      acc += exps[i];
      if (rVal <= acc) {
        const r = mbtiRoles[i];
        return { job: jobMap[`${mbti}_${r}`], roleUsed: r };
      }
    }
    const r = mbtiRoles[mbtiRoles.length - 1];
    return { job: jobMap[`${mbti}_${r}`], roleUsed: r };
  }

  // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ãƒ­ãƒ¼ãƒ«ã‚¹ã‚³ã‚¢é †ã«æ¢ç´¢
  const fallbackSearch = fallbackOrder[role] || Object.keys(fallbackOrder)[0];
  for (const r of fallbackSearch) {
    const key = `${mbti}_${r}`;
    if (jobMap[key]) return { job: jobMap[key], roleUsed: r };
  }

  // æœ€çµ‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: Hammingè·é›¢
  const candidates = Object.keys(jobMap).map((k) => {
    const [t, r] = k.split('_');
    const dType = hamming(mbti, t);
    const dRole = (roleDist[role] && roleDist[role][r] != null) ? roleDist[role][r] : 3;
    return { key: k, r, score: dType * 10 + dRole };
  });
  let bestScore = Infinity;
  for (const c of candidates) bestScore = Math.min(bestScore, c.score);
  const best = candidates.filter(c => c.score === bestScore);
  const chosen = best[0];
  return { job: jobMap[chosen.key], roleUsed: chosen.r };
}

// ===== ãƒ­ã‚¸ãƒƒã‚¯ =====
let currentQ = 0;
let axisScores = { EI: 0, SN: 0, TF: 0, JP: 0 };
let selectedVal = null;
let answerHistory = []; // æˆ»ã‚‹ãƒœã‚¿ãƒ³ç”¨ï¼šå„å•ã®å›ç­”å€¤ã‚’è¨˜éŒ²

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function goHome() {
  // ã‚¹ã‚³ã‚¢ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ã‚¤ãƒ³ãƒˆãƒ­ç”»é¢ã«æˆ»ã‚‹
  currentQ = 0;
  axisScores = { EI: 0, SN: 0, TF: 0, JP: 0 };
  selectedVal = null;
  answerHistory = [];
  showScreen('screen-intro');
}

function startQuiz() {
  currentQ = 0;
  axisScores = { EI: 0, SN: 0, TF: 0, JP: 0 };
  selectedVal = null;
  answerHistory = [];
  showScreen('screen-quiz');
  renderQuestion();
}

function renderQuestion() {
  const q = questions[currentQ];
  selectedVal = null;

  const total = questions.length;
  document.getElementById('question-number').textContent = `ç¬¬ ${currentQ + 1} å•`;
  document.getElementById('progress-text').textContent = `Question ${currentQ + 1} / ${total}`;
  document.getElementById('progress-fill').style.width = `${((currentQ + 1) / total) * 100}%`;

  const card = document.getElementById('question-card');
  card.style.animation = 'none';
  card.offsetHeight;
  card.style.animation = 'fadeIn 0.4s ease';

  document.getElementById('question-text').textContent = q.text;

  const area = document.getElementById('scale-area');
  area.innerHTML = `
    <div class="scale-wrap">
      ${SCALE.map(s => `
        <div class="scale-row" data-val="${s.val}" onclick="selectScale(${s.val}, this)">
          <div class="scale-radio"></div>
          <div class="scale-label">${s.label}</div>
        </div>
      `).join('')}
    </div>
    <div style="display:flex;gap:12px;margin-top:8px;">
      ${currentQ > 0 ? `<button class="next-btn visible" id="back-btn" onclick="prevQuestion()" style="background:transparent;border:1px solid rgba(201,168,76,0.4);color:var(--gold);flex:0 0 auto;padding:12px 20px;">&larr; æˆ»ã‚‹</button>` : ''}
      <button class="next-btn" id="next-btn" onclick="nextQuestion()" style="${currentQ > 0 ? 'flex:1;' : ''}">æ¬¡ã¸ &rarr;</button>
    </div>
  `;
}

function selectScale(val, el) {
  selectedVal = val;
  document.querySelectorAll('.scale-row').forEach(r => r.classList.remove('selected'));
  el.classList.add('selected');
  document.getElementById('next-btn').classList.add('visible');
}

function nextQuestion() {
  if (selectedVal === null) return;
  // å›ç­”å±¥æ­´ã«ä¿å­˜
  answerHistory.push(selectedVal);
  // 1å•1è»¸ãƒ»é€†è»¢é …ç›®å¯¾å¿œã‚¹ã‚³ã‚¢åŠ ç®—
  const q = questions[currentQ];
  const val = q.reversed ? -selectedVal : selectedVal;
  axisScores[q.axis] += val;
  currentQ++;
  if (currentQ < questions.length) {
    renderQuestion();
  } else {
    showResult();
  }
}

function prevQuestion() {
  if (currentQ <= 0) return;
  currentQ--;
  // å‰ã®å›ç­”ã‚’å–ã‚Šå‡ºã—ã¦ã‚¹ã‚³ã‚¢ã‚’å·»ãæˆ»ã™
  const prevVal = answerHistory.pop();
  const q = questions[currentQ];
  const prevValAdjusted = q.reversed ? -prevVal : prevVal;
  axisScores[q.axis] -= prevValAdjusted;
  renderQuestion();
  // å‰å›ã®é¸æŠã‚’å¾©å…ƒè¡¨ç¤º
  setTimeout(() => {
    const row = document.querySelector(`.scale-row[data-val="${prevVal}"]`);
    if (row) {
      selectedVal = prevVal;
      row.classList.add('selected');
      document.getElementById('next-btn').classList.add('visible');
    }
  }, 50);
}

function showResult() {
  showScreen('screen-loading');
  setTimeout(() => {
    const mbti =
      (axisScores.EI >= 0 ? 'E' : 'I') +
      (axisScores.SN >= 0 ? 'S' : 'N') +
      (axisScores.TF >= 0 ? 'T' : 'F') +
      (axisScores.JP >= 0 ? 'J' : 'P');

    const role = determineRole(axisScores);
    const picked = findJob(mbti, role, axisScores);
    const job = picked.job;
    const roleUsed = picked.roleUsed;
// ã‚¸ãƒ§ãƒ–ã‚¢ãƒ¼ãƒˆç”»åƒ
    const imgKey = job.imgKey;
    const iconEl = document.getElementById('result-icon');
    if (imgKey && JOB_IMAGES[imgKey]) {
      const imagePositions = { Reaper: 'top center' };
      const pos = imagePositions[imgKey] || 'top center';
      iconEl.innerHTML = `<img class="result-job-art" src="${JOB_IMAGES[imgKey]}" alt="${job.nameJp}" style="object-position:${pos}">`;
    } else {
      iconEl.style.fontSize = '120px';
      iconEl.style.display = 'block';
      iconEl.style.padding = '40px 0';
      iconEl.textContent = job.icon;
    }
    document.getElementById('result-mbti').textContent = mbti;
    document.getElementById('result-job-name').textContent = job.name;
    document.getElementById('result-job-name-jp').textContent = job.nameJp;
    document.getElementById('result-desc').textContent = job.desc;

    // ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¸è¡¨ç¤º
    const roleColors = { ã‚¿ãƒ³ã‚¯:'#5b8dd9', ãƒ’ãƒ¼ãƒ©ãƒ¼:'#7cba8a', 'è¿‘æ¥DPS':'#c04b1a', 'é éš”DPS':'#c49a1a', ã‚­ãƒ£ã‚¹ã‚¿ãƒ¼:'#7a4fcf' };
    const roleEl = document.getElementById('result-job-name-jp');
    roleEl.innerHTML = `${job.nameJp} &nbsp;<span style="font-size:11px;padding:3px 10px;border:1px solid ${roleColors[job.role]||'#c9a84c'};color:${roleColors[job.role]||'#c9a84c'};font-family:'Cinzel',serif;letter-spacing:2px;">${job.role}</span>`;

    document.getElementById('result-traits').innerHTML =
      job.traits.map(t => `<span class="trait">${t}</span>`).join('');

    // ã‚¹ã‚³ã‚¢ãƒãƒ¼ï¼ˆMBTI 4è»¸ï¼‰
    const barsEl = document.getElementById('score-bars');
    const axes = [
      { label:['å¤–å‘ (E)','å†…å‘ (I)'],   axis:'EI', colorL:'#e87ca0', colorR:'#7a4fcf' },
      { label:['æ„Ÿè¦š (S)','ç›´æ„Ÿ (N)'],   axis:'SN', colorL:'#7cba8a', colorR:'#5b8dd9' },
      { label:['æ€è€ƒ (T)','æ„Ÿæƒ… (F)'],   axis:'TF', colorL:'#c04b1a', colorR:'#d4af37' },
      { label:['åˆ¤æ–­ (J)','çŸ¥è¦š (P)'],   axis:'JP', colorL:'#4a8fb5', colorR:'#8b4db5' },
    ];
    barsEl.innerHTML = axes.map(ax => {
      // å„è»¸ã®æœ€å¤§åˆ°é”ã‚¹ã‚³ã‚¢ã‚’é‡ã¿ã‹ã‚‰å‹•çš„è¨ˆç®—
      const maxScore = questions.filter(q => q.axis === ax.axis).length * 3;
      const raw = axisScores[ax.axis];
      // ä¸­å¿ƒ(0)ã‚’50%ã¨ã—ã¦å·¦å³ã«æŒ¯ã‚‹
      const halfPct = maxScore > 0 ? Math.round((Math.abs(raw) / maxScore) * 50) : 0;
      const isLeft = raw >= 0; // E/S/T/Jå´
      const fillStart = isLeft ? 50 : (50 - halfPct);
      const fillWidth = halfPct;
      const color = isLeft ? ax.colorL : ax.colorR;
      const pctDisplay = maxScore > 0 ? Math.round((Math.abs(raw) / maxScore) * 100) : 0;
      return `
        <div class="score-bar">
          <div class="score-label"><span>${ax.label[0]}</span><span>${ax.label[1]}</span></div>
          <div class="score-track" style="position:relative;">
            <div class="score-fill" style="position:absolute;left:${fillStart}%;width:${fillWidth}%;background:${color};height:100%;border-radius:3px;transition:width 1s ease 0.5s;"></div>
            <div style="position:absolute;left:50%;top:-2px;width:2px;height:10px;background:rgba(255,255,255,0.25);transform:translateX(-50%);"></div>
          </div>
          <div style="display:flex;justify-content:${isLeft ? 'flex-start' : 'flex-end'};font-size:11px;color:${color};margin-top:3px;padding:0 2px;opacity:0.8;">${pctDisplay}%</div>
        </div>`;
    }).join('') + `
      <div class="role-chart" id="role-chart-area"></div>`;
    // ãƒ­ãƒ¼ãƒ«ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆæç”»
    drawRoleChart(roleUsed, axisScores);

    // ç›¸æ€§ã‚¸ãƒ§ãƒ–
    const jobKey = Object.keys(jobMap).find(k => jobMap[k] === job);
    renderCompat(jobKey);

    // ã‚·ã‚§ã‚¢ãƒ†ã‚­ã‚¹ãƒˆï¼ˆç›¸æ€§ã‚¸ãƒ§ãƒ–å–å¾—å¾Œã«ç”Ÿæˆï¼‰
    const compats = compatMap[jobKey] || [];
    const compatNames = compats
      .map(c => jobMap[c.key]?.nameJp)
      .filter(Boolean)
      .slice(0, 3)
      .join(' / ');
    const siteUrl = 'https://panakuro.github.io/xiv21personality/';
    const shareText = encodeURIComponent(
      `FF14ã‚¸ãƒ§ãƒ–æ€§æ ¼è¨ºæ–­çµæœï¼š${job.nameJp}ã€Œ${job.traits.join(' / ')}ã€
` +
      `${job.nameJp}ã¨ç›¸æ€§ã®ã„ã„ã‚¸ãƒ§ãƒ–ã¯ï¼š${compatNames}
` +
      `${siteUrl}

` +
      `#FF14 #ã‚¸ãƒ§ãƒ–è¨ºæ–­ #ã‚ãƒ¼ã¨åˆ¶ä½œ`
    );
    document.getElementById('share-btn').href = `https://twitter.com/intent/tweet?text=${shareText}`;

    showScreen('screen-result');

    // é›†è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’Google Sheetsã«é€ä¿¡ï¼ˆå¤±æ•—ã—ã¦ã‚‚è¨ºæ–­ã«ã¯å½±éŸ¿ã—ãªã„ï¼‰
    sendResult({ job: job.name, jobJp: job.nameJp, mbti, role: roleUsed });
  }, 2000);
}

function sendResult(data) {
  const GAS_URL = 'https://script.google.com/macros/s/AKfycbwHxG-LMQr7he39jHvXUkEms9xlj1bIkLfVMtUWJXztEphDyNalmp0iOJVr5eG3l-pa2g/exec';
  fetch(GAS_URL, {
    method: 'POST',
    mode: 'no-cors', // CORSã‚¨ãƒ©ãƒ¼ã‚’å›é¿ï¼ˆGASã®ä»•æ§˜ï¼‰
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data),
  }).catch(() => {}); // å¤±æ•—ã—ã¦ã‚‚ç„¡è¦–
}


function drawRoleChart(role, axisScores) {
  const roleNames  = ['TANK','HEALER','MDPS','RDPS','CDPS'];
  const roleJp     = { TANK:'ã‚¿ãƒ³ã‚¯', HEALER:'ãƒ’ãƒ¼ãƒ©ãƒ¼', MDPS:'è¿‘æ¥DPS', RDPS:'é éš”DPS', CDPS:'ã‚­ãƒ£ã‚¹ã‚¿ãƒ¼' };
  const roleColors = { TANK:'#5b8dd9', HEALER:'#7cba8a', MDPS:'#c04b1a', RDPS:'#c49a1a', CDPS:'#7a4fcf' };

  // determineRoleã¨åŒã˜é‡ã¿ä»˜ãã‚¹ã‚³ã‚¢ã‚’ãƒãƒ£ãƒ¼ãƒˆã«ã‚‚ä½¿ç”¨
  const ei = axisScores.EI, tf = axisScores.TF, sn = axisScores.SN, jp = axisScores.JP;
  const raw = {
    TANK:   ei * 0.6 + tf * 0.5 + jp * 0.4,
    HEALER: ei * 0.4 - tf * 0.6 + jp * 0.3,
    MDPS:   tf * 0.4 + sn * 0.5 - jp * 0.2,
    RDPS:  -ei * 0.3 - tf * 0.3 + sn * 0.3 - jp * 0.2,
    CDPS:  -ei * 0.5 - sn * 0.6 - jp * 0.2,
  };

  // å…¨ãƒ­ãƒ¼ãƒ«ã‚’0ä»¥ä¸Šã«ã‚·ãƒ•ãƒˆã—ã¦æ­£è¦åŒ–
  const minVal = Math.min(...Object.values(raw));
  const shifted = {};
  roleNames.forEach(rn => { shifted[rn] = raw[rn] - minVal + 0.1; });
  // å‡ºãŸã‚¸ãƒ§ãƒ–ã®ãƒ­ãƒ¼ãƒ«ã‚’å¿…ãšMAXã«ã™ã‚‹
  shifted[role] = Math.max(...Object.values(shifted)) * 1.01;
  const maxVal = Math.max(...Object.values(shifted));
  const normalized = {};
  roleNames.forEach(rn => { normalized[rn] = shifted[rn] / maxVal; });

  // SVGäº”è§’å½¢ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ
  const cx = 130, cy = 135, r = 85;
  const angles = [-90, -90+72, -90+144, -90+216, -90+288].map(d => d * Math.PI / 180);

  function pt(i, radius) {
    return [cx + radius * Math.cos(angles[i]), cy + radius * Math.sin(angles[i])];
  }

  // ã‚°ãƒªãƒƒãƒ‰
  let gridLines = '';
  [0.25, 0.5, 0.75, 1.0].forEach(scale => {
    const pts = roleNames.map((_, i) => pt(i, r * scale).join(',')).join(' ');
    gridLines += `<polygon points="${pts}" fill="none" stroke="rgba(201,168,76,0.12)" stroke-width="1"/>`;
  });

  // è»¸ç·š
  const axisLines = roleNames.map((_, i) => {
    const [x, y] = pt(i, r);
    return `<line x1="${cx}" y1="${cy}" x2="${x}" y2="${y}" stroke="rgba(201,168,76,0.15)" stroke-width="1"/>`;
  }).join('');

  // ãƒ‡ãƒ¼ã‚¿ãƒãƒªã‚´ãƒ³
  const dataPoints = roleNames.map((rn, i) => pt(i, r * normalized[rn]).join(','));
  const dataPoly = `<polygon points="${dataPoints.join(' ')}" fill="rgba(201,168,76,0.18)" stroke="#c9a84c" stroke-width="2"/>`;

  // ãƒ‰ãƒƒãƒˆ
  const dots = roleNames.map((rn, i) => {
    const [x, y] = pt(i, r * normalized[rn]);
    const isActive = rn === role;
    return `<circle cx="${x}" cy="${y}" r="${isActive ? 7 : 4}"
      fill="${isActive ? roleColors[rn] : '#c9a84c'}"
      opacity="${isActive ? 1 : 0.7}"
      ${isActive ? 'filter="url(#glow)"' : ''}/>`;
  }).join('');

  // ãƒ©ãƒ™ãƒ«
  const labels = roleNames.map((rn, i) => {
    const [x, y] = pt(i, r + 24);
    const isActive = rn === role;
    return `<text x="${x}" y="${y}" text-anchor="middle" dominant-baseline="middle"
      font-family="Noto Serif JP, serif"
      font-size="${isActive ? 13 : 11}"
      fill="${isActive ? roleColors[rn] : 'rgba(232,223,200,0.45)'}"
      font-weight="${isActive ? 'bold' : 'normal'}">${roleJp[rn]}</text>`;
  }).join('');

  const svg = `
    <svg class="role-pentagon" width="270" height="280" viewBox="0 0 270 280">
      <defs>
        <filter id="glow">
          <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
          <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
        </filter>
      </defs>
      ${gridLines}${axisLines}${dataPoly}${dots}${labels}
    </svg>`;

  const el = document.getElementById('role-chart-area');
  if (el) {
    el.innerHTML = `<div class="role-chart-title">Role Tendency</div>${svg}`;
  }
}

function restartQuiz() {
  startQuiz();
}

// Stars
function createStars() {
  const container = document.getElementById('stars');
  for (let i = 0; i < 80; i++) {
    const star = document.createElement('div');
    star.className = 'star';
    star.style.cssText = `
      left: ${Math.random() * 100}%;
      top: ${Math.random() * 100}%;
      --dur: ${2 + Math.random() * 4}s;
      --op: ${0.2 + Math.random() * 0.6};
      animation-delay: ${Math.random() * 4}s;
    `;
    container.appendChild(star);
  }
}

createStars();
</script>

<script>
/* ===== Debug harness (dev only) ===== */
(function(){
  'use strict';
  function getParams(){
    // Robust for file:// URLs on Chrome/Windows
    return new URLSearchParams(window.location.search || '');
  }
  function isDebug(){
    const p=getParams();
    return p.get('debug')==='1' || p.get('debug')==='true';
  }
  function isAutorun(){
    const p=getParams();
    return p.get('autorun')==='1' || p.get('autorun')==='true';
  }

  function randChoice(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

  // Detect the scale values from the UI definition (fallback to [-2,-1,0,1,2])
  function getScaleValues(){
    // If the page defines SCALE_CHOICES or similar, try to use it.
    if (window.SCALE_CHOICES && Array.isArray(window.SCALE_CHOICES)) {
      const vals = window.SCALE_CHOICES.map(x=>x.value).filter(v=>typeof v==='number');
      if (vals.length) return vals;
    }
    return [-2,-1,0,1,2];
  }

  function computeMBTIFromScores(scores){
    return (scores.EI >= 0 ? 'E':'I') +
           (scores.SN >= 0 ? 'S':'N') +
           (scores.TF >= 0 ? 'T':'F') +
           (scores.JP >= 0 ? 'J':'P');
  }

  function simulateOnce(scaleValues){
    // relies on globals defined in the main script: questions, determineRole, findJob
    const scores = { EI:0, SN:0, TF:0, JP:0 };
    for (let i=0;i<window.questions.length;i++){
      const q = window.questions[i];
      const v = randChoice(scaleValues);
      scores[q.axis] += v;
    }
    const mbti = computeMBTIFromScores(scores);
    const role = window.determineRole(scores);
    const picked = window.findJob(mbti, role, axisScores);
    const job = picked.job;
    const roleUsed = picked.roleUsed;
    // Use a stable key for counting: the jobMap key if possible
    const key = `${mbti}_${roleUsed}`;
    return { key, mbti, roleRequested: role, roleUsed, jobName: job.name, jobNameJp: job.nameJp };
  }

  function toCsv(rows){
    const header = ['rank','count','pct','jobName','jobNameJp','exampleKey','roleUsed','mbtiHint'];
    const lines = [header.join(',')];
    rows.forEach((r, idx)=>{
      const line = [
        idx+1,
        r.count,
        (r.pct).toFixed(2),
        `"${String(r.jobName).replaceAll('"','""')}"`,
        `"${String(r.jobNameJp).replaceAll('"','""')}"`,
        `"${String(r.exampleKey).replaceAll('"','""')}"`,
        r.roleUsed,
        r.mbtiHint
      ].join(',');
      lines.push(line);
    });
    return lines.join('\n');
  }

  function download(filename, text){
    const blob = new Blob([text], {type:'text/csv;charset=utf-8'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); }, 0);
  }

  function renderDebugPanel(summary, n, meta){
    // create panel under intro card
    const introCard = document.querySelector('#screen-intro .intro-card');
    if (!introCard) return;

    let panel = document.getElementById('debug-panel');
    if (!panel){
      panel = document.createElement('div');
      panel.id = 'debug-panel';
      panel.style.marginTop = '18px';
      panel.style.textAlign = 'left';
      panel.style.padding = '16px';
      panel.style.border = '1px solid rgba(201,168,76,0.25)';
      panel.style.background = 'rgba(201,168,76,0.04)';
      panel.style.fontSize = '12px';
      panel.style.lineHeight = '1.7';
      introCard.appendChild(panel);
    }

    const top = summary.slice(0, 21);
    const missing = meta.expectedKeys.filter(k=>!meta.seenKeys.has(k));

    const rowsHtml = top.map((r, idx)=>`
      <tr>
        <td style="padding:6px 8px;opacity:.75">${idx+1}</td>
        <td style="padding:6px 8px">${r.jobNameJp} <span style="opacity:.6">(${r.jobName})</span></td>
        <td style="padding:6px 8px">${r.roleUsed}</td>
        <td style="padding:6px 8px;text-align:right">${r.count}</td>
        <td style="padding:6px 8px;text-align:right">${r.pct.toFixed(2)}%</td>
        <td style="padding:6px 8px;opacity:.7">${r.exampleKey}</td>
      </tr>
    `).join('');

    panel.innerHTML = `
      <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:10px">
        <div style="font-family:'Cinzel',serif;letter-spacing:2px;color:var(--gold)">DEBUG RESULTS</div>
        <div style="opacity:.75">N=${n.toLocaleString()}</div>
        <button id="debug-download" style="margin-left:auto;padding:6px 10px;border:1px solid rgba(201,168,76,0.35);background:transparent;color:var(--gold);cursor:pointer;font-family:'Cinzel',serif;letter-spacing:2px;font-size:10px">
          CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        </button>
      </div>

      <div style="opacity:.85;margin-bottom:10px">
        æœŸå¾…ã‚­ãƒ¼æ•°: ${meta.expectedKeys.length} / è¦³æ¸¬ã‚­ãƒ¼æ•°: ${meta.seenKeys.size}
        ${missing.length ? `<br><span style="color:rgba(255,200,200,.9)">æœªå‡ºç¾ã‚­ãƒ¼: ${missing.join(', ')}</span>` : `<br><span style="color:rgba(180,255,200,.9)">æœªå‡ºç¾ã‚­ãƒ¼ãªã—ï¼ˆåˆ°é”æ€§OKï¼‰</span>`}
      </div>

      <div style="overflow:auto;border:1px solid rgba(255,255,255,0.08);border-radius:3px">
        <table style="width:100%;border-collapse:collapse;min-width:640px">
          <thead>
            <tr style="background:rgba(0,0,0,0.25)">
              <th style="padding:8px 8px;text-align:left">#</th>
              <th style="padding:8px 8px;text-align:left">Job</th>
              <th style="padding:8px 8px;text-align:left">RoleUsed</th>
              <th style="padding:8px 8px;text-align:right">Count</th>
              <th style="padding:8px 8px;text-align:right">%</th>
              <th style="padding:8px 8px;text-align:left">Example Key</th>
            </tr>
          </thead>
          <tbody>${rowsHtml}</tbody>
        </table>
      </div>
      <div style="margin-top:10px;opacity:.7">
        â€» ã“ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€Œå„è¨­å•ã§ -2,-1,0,1,2 ã‚’ç­‰ç¢ºç‡ã§é¸ã¶ã€ä¹±æŠã§ã™ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ†å¸ƒã¯æœªåæ˜ ï¼‰ã€‚
      </div>
    `;

    const btn = document.getElementById('debug-download');
    if (btn){
      btn.onclick = () => download('ff14-job-quiz_debug_counts.csv', toCsv(summary));
    }
  }

  // public
  window.runDebugSimulation = async function runDebugSimulation(){
    const n = 10000;
    const scaleValues = getScaleValues();

    const btn = document.getElementById('debug-btn');
    const status = document.getElementById('debug-status');

    if (btn){ btn.disabled = true; btn.style.opacity = '0.7'; btn.textContent = 'å®Ÿè¡Œä¸­...'; }
    if (status){ status.style.display='block'; status.textContent = 'debug=ON  search=' + window.location.search + ' / running... 0%'; }

    // Let the browser paint the "running" state before heavy work
    await new Promise(r => setTimeout(r, 0));

    const counts = new Map(); // jobName -> {count, jobNameJp, roleUsed, exampleKey, mbtiHint}
    const seenKeys = new Set();

    // expected keys = jobMap keys (these are the "21é€šã‚Š" etc.)
    const expectedKeys = Object.keys(window.jobMap || {});

    const chunk = 250; // yield every N iterations so UI stays responsive
    for (let i=0;i<n;i++){
      const r = simulateOnce(scaleValues);
      seenKeys.add(r.key);

      const k = r.jobName; // count by final job (what user sees)
      const prev = counts.get(k);
      if (prev){
        prev.count += 1;
      } else {
        counts.set(k, { count: 1, jobName: r.jobName, jobNameJp: r.jobNameJp, roleUsed: r.roleUsed, exampleKey: r.key, mbtiHint: r.mbti });
      }

      if ((i+1) % chunk === 0){
        if (status){
          const pct = Math.floor(((i+1)/n) * 100);
          status.textContent = 'debug=ON  search=' + window.location.search + ' / running... ' + pct + '%';
        }
        // yield to UI thread
        await new Promise(r => setTimeout(r, 0));
      }
    }

    const summary = Array.from(counts.values())
      .map(x => ({...x, pct: (x.count / n) * 100}))
      .sort((a,b)=>b.count-a.count);

    renderDebugPanel(summary, n, { expectedKeys, seenKeys });

    if (status){
      status.textContent = 'debug=ON  search=' + window.location.search + ' / done âœ…';
    }
    if (btn){
      btn.disabled = false;
      btn.style.opacity = '';
      btn.textContent = 'ãƒ‡ãƒãƒƒã‚°ï¼šãƒ©ãƒ³ãƒ€ãƒ 10,000å›';
    }
  };

  // Activate debug UI if requested
  document.addEventListener('DOMContentLoaded', () => {
    if (!isDebug()) return;
    const btn = document.getElementById('debug-btn');
    if (btn) btn.style.display = 'inline-block';
    const dbg=document.getElementById('debug-status');
    if(dbg){ dbg.style.display='block'; dbg.textContent = 'debug=ON  search=' + window.location.search; }

    if (isAutorun()){
      // small delay so layout is ready
      setTimeout(()=>window.runDebugSimulation(), 50);
    }
  });
})();
</script>

<footer style="
  text-align:center;
  padding:32px 20px 40px;
  font-size:11px;
  color:rgba(232,223,200,0.35);
  line-height:1.8;
  letter-spacing:0.05em;
">
  æœ¬ã‚µã‚¤ãƒˆã¯ãƒ•ã‚¡ãƒ³ãŒåˆ¶ä½œã—ãŸéå…¬å¼ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã§ã™ã€‚<br>
  FINAL FANTASY XIV &copy; SQUARE ENIX CO., LTD. All Rights Reserved.<br>
  ã€ŒFINAL FANTASYã€ã¯ã‚¹ã‚¯ã‚¦ã‚§ã‚¢ãƒ»ã‚¨ãƒ‹ãƒƒã‚¯ã‚¹æ ªå¼ä¼šç¤¾ã®ç™»éŒ²å•†æ¨™ã§ã™ã€‚<br>
  <span style="margin-top:6px;display:inline-block;">åˆ¶ä½œï¼šã‚ãƒ¼ã¨ &nbsp;|&nbsp; <a href="https://twitter.com/Art_Xivss" target="_blank" style="color:rgba(232,223,200,0.5);text-decoration:none;">@Art_Xivss</a></span>
</footer>
</body>
</html>